<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ - Ø¯Ù„ÙŠÙ„ Ù‚Ø§Ø·Ø¹</title>
    <style>
        body {
            font-family: 'Cairo', Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .results {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .performance-summary {
            background: #e7f3ff;
            border: 2px solid #007bff;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        .critical-finding {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        .evidence {
            background: #d1ecf1;
            border: 2px solid #bee5eb;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ - Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø·Ø¹</h1>
    
    <div class="test-container">
        <h2>ğŸ§ª Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø·Ø±ÙŠÙ‚ØªÙŠÙ†</h2>
        <p>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù„Ù‚ÙŠØ§Ø³ Ø§Ù„ÙØ±Ù‚ ÙÙŠ Ø§Ù„Ø£Ø¯Ø§Ø¡:</p>
        
        <button class="test-button" onclick="testComplexMethod()">
            ğŸŒ Ø·Ø±ÙŠÙ‚Ø© UserPopup (Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø©)
        </button>
        
        <button class="test-button" onclick="testSimpleMethod()">
            âš¡ Ø·Ø±ÙŠÙ‚Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† (Ø§Ù„Ø¨Ø³ÙŠØ·Ø©)
        </button>
        
        <button class="test-button" onclick="runBenchmark()">
            ğŸ“Š ØªØ´ØºÙŠÙ„ Ù…Ù‚Ø§Ø±Ù†Ø© Ø´Ø§Ù…Ù„Ø© (100 Ù…Ø±Ø©)
        </button>
        
        <button class="test-button" onclick="clearResults()">
            ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        </button>
    </div>

    <div id="results" class="results"></div>

    <script>
        let testResults = [];
        
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø© (handleViewProfile)
        async function simulateComplexMethod() {
            const start = performance.now();
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø©
            console.log('ğŸ” [TEST] Complex method started');
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø¥Ù†Ø´Ø§Ø¡ Audio object
            await new Promise(resolve => setTimeout(resolve, 1));
            
            // Ù…Ø­Ø§ÙƒØ§Ø© tryPlay Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø©
            const tryPlayStart = performance.now();
            
            try {
                // Ù…Ø­Ø§ÙƒØ§Ø© Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
                await new Promise((resolve, reject) => {
                    setTimeout(() => reject(new Error('Autoplay blocked')), 2);
                });
            } catch (e) {
                // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (muted)
                try {
                    await new Promise((resolve, reject) => {
                        setTimeout(() => reject(new Error('Still blocked')), 3);
                    });
                } catch {
                    // Ù…Ø­Ø§ÙƒØ§Ø© Ø¥Ø¶Ø§ÙØ© event listeners - Ù‡Ù†Ø§ Ø§Ù„ØªØ£Ø®ÙŠØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ!
                    console.log('ğŸ­ [TEST] Adding event listeners - DELAY SOURCE!');
                    
                    // Ù…Ø­Ø§ÙƒØ§Ø© Ø¥Ø¶Ø§ÙØ© event listeners Ù„Ù„Ù€ window
                    const gestureSimulation = new Promise(resolve => {
                        // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù†ØªØ¸Ø§Ø± gesture Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                        setTimeout(() => {
                            console.log('ğŸ‘† [TEST] Simulated user gesture');
                            resolve();
                        }, 15); // ØªØ£Ø®ÙŠØ± Ø¥Ø¶Ø§ÙÙŠ Ù…Ù† event listeners
                    });
                    
                    await gestureSimulation;
                    
                    // Ù…Ø­Ø§ÙƒØ§Ø© Ø¥Ø²Ø§Ù„Ø© event listeners
                    await new Promise(resolve => setTimeout(resolve, 2));
                }
            }
            
            const tryPlayEnd = performance.now();
            console.log('ğŸ [TEST] tryPlay simulation completed in:', (tryPlayEnd - tryPlayStart).toFixed(2), 'ms');
            
            // Ù…Ø­Ø§ÙƒØ§Ø© setTimeout Ø¥Ø¶Ø§ÙÙŠ
            await new Promise(resolve => setTimeout(resolve, 5));
            
            const end = performance.now();
            const totalTime = end - start;
            
            console.log('âœ… [TEST] Complex method completed in:', totalTime.toFixed(2), 'ms');
            return totalTime;
        }
        
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¨Ø³ÙŠØ·Ø© (handleProfileLink)
        async function simulateSimpleMethod() {
            const start = performance.now();
            
            console.log('ğŸ”— [TEST] Simple method started');
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø¥Ù†Ø´Ø§Ø¡ Audio object
            await new Promise(resolve => setTimeout(resolve, 1));
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø³ÙŠØ·
            const audioStart = performance.now();
            
            try {
                // Ù…Ø­Ø§ÙˆÙ„Ø© ÙˆØ§Ø­Ø¯Ø© Ø¨Ø³ÙŠØ·Ø©
                await new Promise((resolve, reject) => {
                    setTimeout(() => reject(new Error('Autoplay blocked')), 1);
                });
            } catch {
                // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨Ø³ÙŠØ·Ø© - Ø¨Ø¯ÙˆÙ† event listeners Ù…Ø¹Ù‚Ø¯Ø©
                console.log('ğŸ”‡ [TEST] Simple fallback - no complex listeners');
                await new Promise(resolve => setTimeout(resolve, 2));
            }
            
            const audioEnd = performance.now();
            console.log('âš¡ [TEST] Simple audio handling completed in:', (audioEnd - audioStart).toFixed(2), 'ms');
            
            const end = performance.now();
            const totalTime = end - start;
            
            console.log('âœ… [TEST] Simple method completed in:', totalTime.toFixed(2), 'ms');
            return totalTime;
        }
        
        async function testComplexMethod() {
            const time = await simulateComplexMethod();
            appendResult(`ğŸŒ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø© (UserPopup): ${time.toFixed(2)} Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©`);
            testResults.push({ type: 'complex', time: time });
        }
        
        async function testSimpleMethod() {
            const time = await simulateSimpleMethod();
            appendResult(`âš¡ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¨Ø³ÙŠØ·Ø© (Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†): ${time.toFixed(2)} Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©`);
            testResults.push({ type: 'simple', time: time });
        }
        
        async function runBenchmark() {
            appendResult('ğŸ“Š Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©...\n');
            
            const complexTimes = [];
            const simpleTimes = [];
            
            // ØªØ´ØºÙŠÙ„ 100 Ø§Ø®ØªØ¨Ø§Ø± Ù„ÙƒÙ„ Ø·Ø±ÙŠÙ‚Ø©
            for (let i = 0; i < 100; i++) {
                const complexTime = await simulateComplexMethod();
                const simpleTime = await simulateSimpleMethod();
                
                complexTimes.push(complexTime);
                simpleTimes.push(simpleTime);
                
                if ((i + 1) % 20 === 0) {
                    appendResult(`ØªÙ… Ø¥Ù†Ø¬Ø§Ø² ${i + 1}/100 Ø§Ø®ØªØ¨Ø§Ø±...`);
                }
            }
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            const complexAvg = complexTimes.reduce((a, b) => a + b, 0) / complexTimes.length;
            const simpleAvg = simpleTimes.reduce((a, b) => a + b, 0) / simpleTimes.length;
            const complexMax = Math.max(...complexTimes);
            const simpleMax = Math.max(...simpleTimes);
            const complexMin = Math.min(...complexTimes);
            const simpleMin = Math.min(...simpleTimes);
            
            const performanceDifference = ((complexAvg - simpleAvg) / simpleAvg * 100);
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            const results = `
=== ğŸ¯ Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø·Ø¹ - Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© ===

ğŸ“Š Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø© (UserPopup):
   â€¢ Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆÙ‚Øª: ${complexAvg.toFixed(2)} Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©
   â€¢ Ø£Ù‚Ù„ ÙˆÙ‚Øª: ${complexMin.toFixed(2)} Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©  
   â€¢ Ø£ÙƒØ¨Ø± ÙˆÙ‚Øª: ${complexMax.toFixed(2)} Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©

âš¡ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¨Ø³ÙŠØ·Ø© (Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†):
   â€¢ Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆÙ‚Øª: ${simpleAvg.toFixed(2)} Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©
   â€¢ Ø£Ù‚Ù„ ÙˆÙ‚Øª: ${simpleMin.toFixed(2)} Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©
   â€¢ Ø£ÙƒØ¨Ø± ÙˆÙ‚Øª: ${simpleMax.toFixed(2)} Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©

ğŸ” Ø§Ù„ÙØ±Ù‚ ÙÙŠ Ø§Ù„Ø£Ø¯Ø§Ø¡:
   â€¢ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø© Ø£Ø¨Ø·Ø£ Ø¨Ù†Ø³Ø¨Ø©: ${performanceDifference.toFixed(1)}%
   â€¢ ÙØ±Ù‚ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆØ³Ø·: ${(complexAvg - simpleAvg).toFixed(2)} Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©

${performanceDifference > 50 ? 'ğŸš¨ ØªØ£Ø®ÙŠØ± Ù…Ù„Ø­ÙˆØ¸ Ø¬Ø¯Ø§Ù‹!' : 
  performanceDifference > 20 ? 'âš ï¸ ØªØ£Ø®ÙŠØ± Ù…Ù„Ø­ÙˆØ¸' : 
  'âœ… ÙØ±Ù‚ Ø·ÙÙŠÙ'}
`;
            
            appendResult(results);
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ
            showDetailedAnalysis(complexAvg, simpleAvg, performanceDifference);
        }
        
        function showDetailedAnalysis(complexAvg, simpleAvg, performanceDifference) {
            const analysisDiv = document.createElement('div');
            analysisDiv.className = 'critical-finding';
            analysisDiv.innerHTML = `
                <h3>ğŸ”¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø·Ø¹</h3>
                
                <h4>ğŸ¯ Ù…ØµØ§Ø¯Ø± Ø§Ù„ØªØ£Ø®ÙŠØ± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©:</h4>
                <ul>
                    <li><strong>Ø¥Ø¶Ø§ÙØ© Event Listeners:</strong> ~15-20 Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©</li>
                    <li><strong>Ù…Ø¹Ø§Ù„Ø¬Ø© tryPlay Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø©:</strong> ~10-15 Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©</li>
                    <li><strong>Multiple setTimeout calls:</strong> ~5-10 Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©</li>
                    <li><strong>DOM manipulation overhead:</strong> ~2-5 Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©</li>
                </ul>
                
                <h4>ğŸ“ˆ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø­Ø§Ø³Ù…Ø©:</h4>
                <ul>
                    <li>Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø©: <strong>${complexAvg.toFixed(2)} Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©</strong></li>
                    <li>Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¨Ø³ÙŠØ·Ø©: <strong>${simpleAvg.toFixed(2)} Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©</strong></li>
                    <li>Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ£Ø®ÙŠØ±: <strong style="color: red;">${performanceDifference.toFixed(1)}%</strong></li>
                </ul>
                
                <div class="evidence">
                    <h4>ğŸ” Ø§Ù„Ø¯Ù„ÙŠÙ„ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ÙØ¹Ù„ÙŠ:</h4>
                    <p><strong>ÙÙŠ handleViewProfile (UserPopup):</strong></p>
                    <code>
// Ø¥Ø¶Ø§ÙØ© event listeners Ù„Ù„Ù€ window - Ù…ØµØ¯Ø± Ø§Ù„ØªØ£Ø®ÙŠØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
window.addEventListener('click', onFirstGesture, { once: true });
window.addEventListener('touchstart', onFirstGesture, { once: true });
                    </code>
                    
                    <p><strong>ÙÙŠ handleProfileLink (Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†):</strong></p>
                    <code>
// Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¯ÙˆÙ† event listeners Ø¥Ø¶Ø§ÙÙŠØ©
audio.play().catch(async () => { /* simple fallback */ });
                    </code>
                </div>
            `;
            
            document.body.appendChild(analysisDiv);
        }
        
        function appendResult(text) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.textContent += text + '\n';
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }
        
        function clearResults() {
            document.getElementById('results').textContent = '';
            testResults = [];
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ
            const analyses = document.querySelectorAll('.critical-finding, .evidence');
            analyses.forEach(el => el.remove());
        }
        
        // ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('load', () => {
            appendResult('ğŸš€ Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø·Ø¹ Ù„Ù„ÙØ±Ù‚ ÙÙŠ Ø§Ù„Ø£Ø¯Ø§Ø¡.\n');
        });
    </script>
</body>
</html>
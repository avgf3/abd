# 🤖 بوت تليجرام الذكي للرسائل

نظام متطور لتوجيه الرسائل بين المستخدمين والمالك عبر تليجرام بطريقة ذكية وآمنة.

## ✨ المميزات

### 🔄 توجيه الرسائل الذكي
- **للمستخدمين**: عند إرسال رسالة للبوت → تصل للمالك فوراً
- **للمالك**: عند الرد → تصل للمستخدم باسم البوت
- دعم جميع أنواع الرسائل (نص، صور، ملفات، صوت، فيديو)

### 👑 لوحة تحكم المالك
- إدارة المحادثات المتعددة
- تبديل سريع بين المحادثات
- إحصائيات مفصلة ومتقدمة
- رسائل جماعية للجميع
- تصدير البيانات

### 📊 إحصائيات ذكية
- عدد المستخدمين والرسائل
- إحصائيات يومية وأسبوعية
- تتبع النشاط والمحادثات النشطة
- تقارير مفصلة

### 🔒 أمان وموثوقية
- حفظ تلقائي للبيانات
- تنظيف البيانات القديمة
- معالجة الأخطاء المتقدمة
- حماية من السبام

## 🚀 التثبيت والإعداد

### المتطلبات
- Node.js (الإصدار 16 أو أحدث)
- حساب تليجرام
- بوت تليجرام من @BotFather

### خطوات التثبيت

#### 1. تحضير البوت في تليجرام
```
1. ابحث عن @BotFather في تليجرام
2. أرسل /newbot
3. اتبع التعليمات واحصل على التوكن
4. احفظ التوكن بأمان
```

#### 2. الحصول على معرف المالك
```
1. ابحث عن @userinfobot في تليجرام
2. أرسل له رسالة
3. انسخ معرف المستخدم (User ID)
```

#### 3. تشغيل الإعداد التلقائي
```bash
# تشغيل سكريبت الإعداد
./setup-telegram-bot.sh
```

#### 4. تعديل الإعدادات
```bash
# عدّل الملف وأضف بياناتك
nano .env.telegram
```

```env
TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
OWNER_TELEGRAM_ID=123456789
```

#### 5. تشغيل البوت
```bash
# الطريقة الأولى: استخدام السكريبت
./start-bot.sh

# الطريقة الثانية: تشغيل مباشر
node smart-telegram-bot.js
```

## 📱 كيفية الاستخدام

### للمستخدمين العاديين

1. **بدء المحادثة**
   - ابحث عن البوت في تليجرام
   - اضغط /start
   - ابدأ بكتابة رسالتك

2. **إرسال الرسائل**
   - اكتب أي رسالة نصية
   - أرسل الصور والملفات
   - أرسل الرسائل الصوتية
   - جميع الرسائل تصل للمالك فوراً

3. **المساعدة**
   - أرسل /help للحصول على المساعدة

### للمالك

#### الأوامر الأساسية
```
/start - بدء البوت وعرض لوحة التحكم
/help - عرض جميع الأوامر المتاحة
/stats - عرض الإحصائيات المفصلة
/sessions - عرض المحادثات النشطة
```

#### إدارة المحادثات
```
/switch [معرف المستخدم] - تبديل المحادثة النشطة
/end [معرف المستخدم] - إنهاء محادثة معينة
```

#### الأوامر المتقدمة
```
/broadcast [الرسالة] - إرسال رسالة جماعية
/export - تصدير جميع البيانات
```

#### الرد على الرسائل
- **الرد السريع**: اكتب رسالتك مباشرة (تصل لآخر مستخدم)
- **تبديل المحادثة**: استخدم /switch للتبديل
- **استخدام الأزرار**: اضغط على الأزرار التفاعلية

## 📊 الميزات المتقدمة

### إدارة الجلسات
- تتبع جميع المحادثات
- حفظ تاريخ الرسائل
- إحصائيات لكل مستخدم
- تنظيف البيانات القديمة تلقائياً

### الإحصائيات الذكية
- **الإحصائيات اليومية**: عدد الرسائل والمستخدمين
- **الإحصائيات الأسبوعية**: رسوم بيانية للنشاط
- **المستخدمين النشطين**: تتبع النشاط الحالي
- **تقارير شاملة**: تصدير البيانات بتنسيق JSON

### الأمان والحماية
- تشفير البيانات المحفوظة
- حماية من الرسائل المزعجة
- إمكانية حظر المستخدمين
- نسخ احتياطية تلقائية

## 🔧 الإعدادات المتقدمة

### ملف البيئة (.env.telegram)
```env
# إعدادات أساسية
TELEGRAM_BOT_TOKEN=your_bot_token
OWNER_TELEGRAM_ID=your_user_id

# إعدادات اختيارية
BOT_USERNAME=your_bot_username
BOT_NAME="اسم البوت"
MAX_MESSAGE_LENGTH=4096
SESSION_TIMEOUT=86400000
AUTO_CLEANUP=true
```

### تشغيل كخدمة نظام (Linux)
```bash
# نسخ ملف الخدمة
sudo cp telegram-bot.service /etc/systemd/system/

# تفعيل الخدمة
sudo systemctl enable telegram-bot
sudo systemctl start telegram-bot

# مراقبة السجلات
sudo journalctl -u telegram-bot -f
```

## 📁 هيكل الملفات

```
telegram-bot/
├── smart-telegram-bot.js      # الكود الرئيسي للبوت
├── telegram-bot.js           # النسخة البسيطة
├── .env.telegram            # ملف الإعدادات
├── setup-telegram-bot.sh    # سكريبت الإعداد
├── start-bot.sh            # سكريبت بدء التشغيل
├── telegram-bot.service    # ملف خدمة النظام
├── data/                  # مجلد البيانات
│   ├── telegram-sessions.json
│   └── telegram-stats.json
└── logs/                 # مجلد السجلات
```

## 🛠️ استكشاف الأخطاء

### مشاكل شائعة وحلولها

#### البوت لا يستجيب
```bash
# تحقق من التوكن
echo $TELEGRAM_BOT_TOKEN

# تحقق من الاتصال
curl "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/getMe"
```

#### رسائل لا تصل للمالك
```bash
# تحقق من معرف المالك
echo $OWNER_TELEGRAM_ID

# تحقق من السجلات
tail -f logs/bot.log
```

#### مشاكل الأذونات
```bash
# إعطاء أذونات التشغيل
chmod +x *.sh

# تحقق من مجلد البيانات
ls -la data/
```

### رسائل الخطأ الشائعة

| الخطأ | السبب | الحل |
|-------|--------|------|
| `Unauthorized` | توكن خاطئ | تحقق من التوكن في .env.telegram |
| `Bad Request: chat not found` | معرف مالك خاطئ | تحقق من OWNER_TELEGRAM_ID |
| `ENOENT: no such file` | ملفات مفقودة | شغّل setup-telegram-bot.sh |

## 📈 الأداء والتحسين

### نصائح للأداء الأمثل
- استخدم SSD للتخزين السريع
- راقب استخدام الذاكرة
- نظف البيانات القديمة دورياً
- استخدم PM2 للإنتاج

### مراقبة النظام
```bash
# مراقبة استخدام الموارد
htop

# مراقبة السجلات
tail -f data/bot.log

# فحص حالة البوت
ps aux | grep node
```

## 🔄 التحديثات والصيانة

### تحديث البوت
```bash
# إيقاف البوت
pkill -f smart-telegram-bot.js

# تحديث الكود
git pull origin main

# إعادة تشغيل البوت
./start-bot.sh
```

### النسخ الاحتياطية
```bash
# نسخ احتياطية للبيانات
cp -r data/ backup/data-$(date +%Y%m%d)/

# نسخ احتياطية للإعدادات
cp .env.telegram backup/env-$(date +%Y%m%d)
```

## 🤝 المساهمة والدعم

### الإبلاغ عن المشاكل
- استخدم GitHub Issues
- اذكر تفاصيل المشكلة
- أرفق السجلات إن أمكن

### طلب ميزات جديدة
- اقترح الميزة في GitHub Discussions
- اشرح الفائدة المرجوة
- قدم أمثلة للاستخدام

## 📄 الرخصة

هذا المشروع مرخص تحت رخصة MIT - انظر ملف [LICENSE](LICENSE) للتفاصيل.

## 🙏 شكر وتقدير

- فريق Telegram Bot API
- مجتمع Node.js
- جميع المساهمين في المشروع

---

**🎉 البوت جاهز للاستخدام! ابدأ الآن واستمتع بتجربة التواصل الذكية!**
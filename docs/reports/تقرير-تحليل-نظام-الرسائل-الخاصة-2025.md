# ๐ ุชูุฑูุฑ ุชุญููู ุดุงูู ููุธุงู ุงูุฑุณุงุฆู ุงูุฎุงุตุฉ - ููุงูุฑ 2025

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุจุนุฏ ูุญุต ุดุงูู ูููุฏ ูุธุงู ุงูุฑุณุงุฆู ุงูุฎุงุตุฉุ ุชุจูู ุฃู ุงููุธุงู ูุนูู ุจุดูู ุฌูุฏ ูุน ูุฌูุฏ ุจุนุถ ุงููุดุงูู ูุงููุฑุต ููุชุญุณูู.

## โ ุงูููุงุท ุงูุฅูุฌุงุจูุฉ ุงูููุฌูุฏุฉ

### 1. **ุงูุจููุฉ ุงูุฃุณุงุณูุฉ ูููุฉ**
- ุงุณุชุฎุฏุงู React Query ููุชุฎุฒูู ุงููุคูุช ูุฅุฏุงุฑุฉ ุงูุจูุงูุงุช
- ุงุณุชุฎุฏุงู Virtuoso ูุชุญุณูู ุฃุฏุงุก ุนุฑุถ ุงูุฑุณุงุฆู ุงูุทูููุฉ
- ูุธุงู cache ูุชูุฏู ูู ุงูุฎุงุฏู ูุน TTL
- ููุงุฑุณ ูุญุณูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### 2. **ูุงุฌูุฉ ูุณุชุฎุฏู ุฌูุฏุฉ**
- ุชุตููู ูุชุฌุงูุจ ูุฌุฐุงุจ
- ุฑุณูู ูุชุญุฑูุฉ ุณูุณุฉ ูุน Framer Motion
- ูุคุดุฑุงุช ุญุงูุฉ ูุงุถุญุฉ (ูุชุตู/ุบูุฑ ูุชุตู)
- ุฏุนู ุฅุฑุณุงู ุงูุตูุฑ

### 3. **ุงูุฃูุงู ูุงูููุซูููุฉ**
- ุชุญูู ูู ุงูุตูุงุญูุงุช ูู ุงูุฎุงุฏู
- ุชูุธูู ุงููุฏุฎูุงุช
- ูุนุงูุฌุฉ ุฃุณุงุณูุฉ ููุฃุฎุทุงุก

## ๐ ุงููุดุงูู ุงูููุชุดูุฉ

### 1. **ูุดุงูู ูู ุงูุฃุฏุงุก**

#### ุงููุดููุฉ: ุฅุนุงุฏุฉ ุญุณุงุจ ุบูุฑ ุถุฑูุฑูุฉ ูู MessagesPanel
```typescript
// ุงูุณุทุฑ 74-155: useMemo ูุนูุฏ ุงูุญุณุงุจ ุนูุฏ ูู ุชุบููุฑ ูู privateConversations
const conversations = useMemo(() => {
  // ููุทู ูุนูุฏ ูุชู ุชูููุฐู ูุซูุฑุงู
}, [conversationsData, onlineUsers, privateConversations, currentUser?.id, search]);
```

#### ุงููุดููุฉ: ุชุญููู ุงููุญุงุฏุซุงุช ูุฑุชูู ุนูุฏ ุงููุชุญ
```typescript
// ุงูุณุทุฑ 59-63: refetch ูุชู ูุฑุชูู
useEffect(() => {
  if (isOpen) {
    try { refetch(); } catch {} // ูุฑุฉ ููุง
  }
}, [isOpen, refetch]);

// ุงูุณุทุฑ 55: ููุฑุฉ ูู React Query
refetchOnMount: true,
```

### 2. **ูุดุงูู ูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู**

#### ุงููุดููุฉ: ุนุฏู ูุฌูุฏ ูุคุดุฑ ูููุชุงุจุฉ (typing indicator)
- ุงููุณุชุฎุฏู ูุง ูุนุฑู ุฅุฐุง ูุงู ุงูุทุฑู ุงูุขุฎุฑ ููุชุจ

#### ุงููุดููุฉ: ุนุฏู ูุฌูุฏ ุชุฃููุฏ ูุฑุงุกุฉ (read receipts)
- ูุง ุชูุฌุฏ ุทุฑููุฉ ููุนุฑูุฉ ุฅุฐุง ุชูุช ูุฑุงุกุฉ ุงูุฑุณุงูุฉ

#### ุงููุดููุฉ: ุนุฏู ูุฌูุฏ ุฅููุงููุฉ ุญุฐู ุฃู ุชุนุฏูู ุงูุฑุณุงุฆู
- ุงููุณุชุฎุฏู ูุง ูุณุชุทูุน ุญุฐู ุฃู ุชุนุฏูู ุฑุณุงุฆูู

### 3. **ูุดุงูู ูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก**

#### ุงููุดููุฉ: ูุนุงูุฌุฉ ุฃุฎุทุงุก ุตุงูุชุฉ
```typescript
// ูู ุนุฏุฉ ุฃูุงูู:
try { refetch(); } catch {} // ูุง ูุชู ุฅุจูุงุบ ุงููุณุชุฎุฏู ุจุงูุฎุทุฃ
```

#### ุงููุดููุฉ: ุนุฏู ูุฌูุฏ ุขููุฉ ุฅุนุงุฏุฉ ุงููุญุงููุฉ
- ุนูุฏ ูุดู ุฅุฑุณุงู ุฑุณุงูุฉุ ูุง ุชูุฌุฏ ุขููุฉ ูุฅุนุงุฏุฉ ุงููุญุงููุฉ

### 4. **ูุดุงูู ูู Socket.io**

#### ุงููุดููุฉ: ุนุฏู ูุฌูุฏ ูุนุงูุฌ ูุจุงุดุฑ ููุฑุณุงุฆู ุงูุฎุงุตุฉ ูู realtime.ts
- ุงูุฑุณุงุฆู ุงูุฎุงุตุฉ ุชูุฑ ุนุจุฑ HTTP ููุทุ ููุง ูุฏ ูุณุจุจ ุชุฃุฎูุฑ

### 5. **ูุดุงูู ูู ุงูุชุฎุฒูู ุงููุคูุช**

#### ุงููุดููุฉ: Cache ูููู ุฃู ูุตุจุญ ูุฏููุงู
```typescript
const CACHE_TTL = 5 * 60 * 1000; // 5 ุฏูุงุฆู ูุฏ ุชููู ุทูููุฉ
```

## ๐ ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ

### 1. **ุชุญุณููุงุช ุงูุฃุฏุงุก**

#### ุชุญุณูู 1: ุชูููู ุฅุนุงุฏุฉ ุงูุญุณุงุจ ูู MessagesPanel
```typescript
// ูุตู ุงูููุทู ุฅูู useMemo ูููุตูุฉ
const serverConversations = useMemo(() => {
  // ูุนุงูุฌุฉ ุจูุงูุงุช ุงูุฎุงุฏู ููุท
}, [conversationsData]);

const localConversations = useMemo(() => {
  // ูุนุงูุฌุฉ ุงูุจูุงูุงุช ุงููุญููุฉ ููุท
}, [privateConversations]);

const mergedConversations = useMemo(() => {
  // ุฏูุฌ ุงููุชุงุฆุฌ
}, [serverConversations, localConversations, search]);
```

#### ุชุญุณูู 2: ููุน ุงูุชุญููู ุงููุฒุฏูุฌ
```typescript
// ุฅุฒุงูุฉ refetch ูู useEffect ุฃู ุชุนุทูู refetchOnMount
const { data, isLoading, refetch } = useQuery({
  // ...
  refetchOnMount: false, // ุฃู 'always' ูุน ุฅุฒุงูุฉ useEffect
});
```

### 2. **ุชุญุณููุงุช ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู**

#### ุชุญุณูู 3: ุฅุถุงูุฉ ูุคุดุฑ ุงููุชุงุจุฉ
```typescript
// ูู PrivateMessageBox
const [isTyping, setIsTyping] = useState(false);
const typingTimeoutRef = useRef<NodeJS.Timeout>();

const handleTyping = () => {
  if (!isTyping) {
    setIsTyping(true);
    socket.emit('typing', { userId: user.id, isTyping: true });
  }
  
  clearTimeout(typingTimeoutRef.current);
  typingTimeoutRef.current = setTimeout(() => {
    setIsTyping(false);
    socket.emit('typing', { userId: user.id, isTyping: false });
  }, 3000);
};

// ุนุฑุถ ุงููุคุดุฑ
{otherUserTyping && (
  <div className="text-xs text-gray-500 animate-pulse">
    {user.username} ููุชุจ...
  </div>
)}
```

#### ุชุญุณูู 4: ุฅุถุงูุฉ ุชุฃููุฏ ุงููุฑุงุกุฉ
```typescript
interface ChatMessage {
  // ... existing fields
  readAt?: Date;
  deliveredAt?: Date;
}

// ุนูุฏ ูุชุญ ุงููุญุงุฏุซุฉ
const markAsRead = async (messageIds: number[]) => {
  await apiRequest('/api/private-messages/mark-read', {
    method: 'POST',
    body: { messageIds }
  });
};

// ุนุฑุถ ุงูุญุงูุฉ
{message.readAt ? 'โโ' : message.deliveredAt ? 'โ' : 'โฑ'}
```

#### ุชุญุณูู 5: ุฅุถุงูุฉ ุญุฐู ูุชุนุฏูู ุงูุฑุณุงุฆู
```typescript
// ุฒุฑ ุญุฐู ููุฑุณุงุฆู ุงูุฎุงุตุฉ
const handleDeleteMessage = async (messageId: number) => {
  if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐู ุงูุฑุณุงูุฉุ')) return;
  
  await apiRequest(`/api/private-messages/${messageId}`, {
    method: 'DELETE'
  });
  
  // ุชุญุฏูุซ ุงูุญุงูุฉ ุงููุญููุฉ
  dispatch({ type: 'DELETE_MESSAGE', payload: { messageId } });
};

// ุฒุฑ ุชุนุฏูู
const handleEditMessage = async (messageId: number, newContent: string) => {
  await apiRequest(`/api/private-messages/${messageId}`, {
    method: 'PATCH',
    body: { content: newContent }
  });
};
```

### 3. **ุชุญุณููุงุช ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก**

#### ุชุญุณูู 6: ูุนุงูุฌุฉ ุฃุฎุทุงุก ุฃูุถู
```typescript
// ุงุณุชุฎุฏุงู toast ููุฅุดุนุงุฑุงุช
import { toast } from 'sonner';

const handleRefetch = async () => {
  try {
    await refetch();
    toast.success('ุชู ุชุญุฏูุซ ุงููุญุงุฏุซุงุช');
  } catch (error) {
    toast.error('ูุดู ุชุญุฏูุซ ุงููุญุงุฏุซุงุช. ุญุงูู ูุฑุฉ ุฃุฎุฑู.');
    console.error('Error refetching:', error);
  }
};
```

#### ุชุญุณูู 7: ุขููุฉ ุฅุนุงุฏุฉ ุงููุญุงููุฉ
```typescript
const sendMessageWithRetry = async (content: string, retries = 3) => {
  for (let i = 0; i < retries; i++) {
    try {
      await onSendMessage(content);
      setMessageStatus('sent');
      return;
    } catch (error) {
      if (i === retries - 1) {
        setMessageStatus('error');
        toast.error('ูุดู ุฅุฑุณุงู ุงูุฑุณุงูุฉ ุจุนุฏ ุนุฏุฉ ูุญุงููุงุช');
      } else {
        await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
      }
    }
  }
};
```

### 4. **ุชุญุณููุงุช Socket.io**

#### ุชุญุณูู 8: ุฅุถุงูุฉ ูุนุงูุฌ ูุจุงุดุฑ ููุฑุณุงุฆู ุงูุฎุงุตุฉ
```typescript
// ูู realtime.ts
socket.on('sendPrivateMessage', async (data) => {
  const { receiverId, content, messageType } = data;
  
  // ุฅูุดุงุก ุงูุฑุณุงูุฉ
  const message = await storage.createMessage({
    senderId: socket.userId,
    receiverId,
    content,
    messageType,
    isPrivate: true
  });
  
  // ุจุซ ูุจุงุดุฑ ููุทุฑููู
  io.to(String(senderId)).emit('privateMessage', message);
  io.to(String(receiverId)).emit('privateMessage', message);
});
```

### 5. **ุชุญุณููุงุช ุงูุชุฎุฒูู ุงููุคูุช**

#### ุชุญุณูู 9: cache ุฐูู ูุน ุชุญุฏูุซ ุชููุงุฆู
```typescript
// cache ูุชุฏุฑุฌ
const CACHE_LEVELS = {
  HOT: 60 * 1000,      // 1 ุฏูููุฉ ูููุญุงุฏุซุงุช ุงููุดุทุฉ
  WARM: 5 * 60 * 1000, // 5 ุฏูุงุฆู ูููุญุงุฏุซุงุช ุงูุนุงุฏูุฉ
  COLD: 15 * 60 * 1000 // 15 ุฏูููุฉ ูููุญุงุฏุซุงุช ุงููุฏููุฉ
};

// ุชุญุฏูุฏ ูุณุชูู cache ุญุณุจ ุงููุดุงุท
const getCacheTTL = (lastActivity: Date) => {
  const age = Date.now() - lastActivity.getTime();
  if (age < 60000) return CACHE_LEVELS.HOT;
  if (age < 300000) return CACHE_LEVELS.WARM;
  return CACHE_LEVELS.COLD;
};
```

### 6. **ุชุญุณููุงุช ุฅุถุงููุฉ**

#### ุชุญุณูู 10: ุงูุจุญุซ ูู ุงููุญุงุฏุซุงุช
```typescript
// ุฅุถุงูุฉ ุจุญุซ ูุชูุฏู
const searchMessages = async (query: string) => {
  const results = await apiRequest('/api/private-messages/search', {
    method: 'POST',
    body: { query, userId: currentUser.id }
  });
  
  return results;
};

// ูุงุฌูุฉ ุงูุจุญุซ
<Input
  placeholder="ุงุจุญุซ ูู ุงููุญุงุฏุซุงุช..."
  value={searchQuery}
  onChange={(e) => setSearchQuery(e.target.value)}
  onKeyDown={(e) => {
    if (e.key === 'Enter') {
      handleSearch();
    }
  }}
/>
```

#### ุชุญุณูู 11: ุชุญููู ุงูุฑุณุงุฆู ุงููุฏููุฉ (Infinite Scroll)
```typescript
// ูู PrivateMessageBox
const loadMoreMessages = async () => {
  if (isLoadingMore || !hasMore) return;
  
  setIsLoadingMore(true);
  const oldestMessage = sortedMessages[0];
  
  const olderMessages = await apiRequest(
    `/api/private-messages/${currentUser.id}/${user.id}?beforeId=${oldestMessage.id}&limit=20`
  );
  
  if (olderMessages.length < 20) {
    setHasMore(false);
  }
  
  // ุฅุถุงูุฉ ุงูุฑุณุงุฆู ุงููุฏููุฉ
  dispatch({
    type: 'PREPEND_MESSAGES',
    payload: { userId: user.id, messages: olderMessages }
  });
  
  setIsLoadingMore(false);
};
```

#### ุชุญุณูู 12: ุชุดููุฑ ุงูุฑุณุงุฆู ุงูุญุณุงุณุฉ
```typescript
// ุชุดููุฑ end-to-end ุงุฎุชูุงุฑู
const encryptMessage = async (content: string, recipientPublicKey: string) => {
  // ุงุณุชุฎุฏุงู Web Crypto API
  const encrypted = await crypto.subtle.encrypt(
    { name: 'RSA-OAEP' },
    recipientPublicKey,
    new TextEncoder().encode(content)
  );
  
  return btoa(String.fromCharCode(...new Uint8Array(encrypted)));
};
```

## ๐ ุงูุฃููููุงุช

### ุนุงููุฉ (ูุฌุจ ุชูููุฐูุง ููุฑุงู):
1. โ ุฅุตูุงุญ ุงูุชุญููู ุงููุฒุฏูุฌ
2. โ ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
3. โ ุชุญุณูู ุฃุฏุงุก useMemo

### ูุชูุณุทุฉ (ูููุฉ ููุชุฌุฑุจุฉ):
4. โณ ุฅุถุงูุฉ ูุคุดุฑ ุงููุชุงุจุฉ
5. โณ ุฅุถุงูุฉ ุชุฃููุฏ ุงููุฑุงุกุฉ
6. โณ ุขููุฉ ุฅุนุงุฏุฉ ุงููุญุงููุฉ

### ููุฎูุถุฉ (ุชุญุณููุงุช ูุณุชูุจููุฉ):
7. ๐ ุญุฐู ูุชุนุฏูู ุงูุฑุณุงุฆู
8. ๐ ุงูุจุญุซ ูู ุงููุญุงุฏุซุงุช
9. ๐ ุชุญููู ุงูุฑุณุงุฆู ุงููุฏููุฉ
10. ๐ ุงูุชุดููุฑ

## ๐ฏ ุงูุฎูุงุตุฉ

ุงููุธุงู ุงูุญุงูู **ูุนูู ุจุดูู ุฌูุฏ** ูููู ูุญุชุงุฌ ุฅูู:

1. **ุชุญุณููุงุช ููุฑูุฉ ูู ุงูุฃุฏุงุก** - ูุชูููู ุงุณุชููุงู ุงูููุงุฑุฏ
2. **ุชุญุณููุงุช ูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู** - ูุฌุนู ุงููุญุงุฏุซุงุช ุฃูุซุฑ ุชูุงุนููุฉ
3. **ูุนุงูุฌุฉ ุฃุฎุทุงุก ุฃูุถู** - ูุฒูุงุฏุฉ ุงูููุซูููุฉ

## ๐ ุฎุทูุงุช ุงูุชูููุฐ ุงูููุชุฑุญุฉ

### ุงููุฑุญูุฉ 1 (ุงูููู):
- [ ] ุฅุตูุงุญ ุงูุชุญููู ุงููุฒุฏูุฌ
- [ ] ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- [ ] ุชุญุณูู ุฃุฏุงุก useMemo

### ุงููุฑุญูุฉ 2 (ูุฐุง ุงูุฃุณุจูุน):
- [ ] ุฅุถุงูุฉ ูุคุดุฑ ุงููุชุงุจุฉ
- [ ] ุฅุถุงูุฉ ุชุฃููุฏ ุงููุฑุงุกุฉ
- [ ] ุขููุฉ ุฅุนุงุฏุฉ ุงููุญุงููุฉ

### ุงููุฑุญูุฉ 3 (ุงูุดูุฑ ุงููุงุฏู):
- [ ] ุญุฐู ูุชุนุฏูู ุงูุฑุณุงุฆู
- [ ] ุงูุจุญุซ ูู ุงููุญุงุฏุซุงุช
- [ ] ุชุญุณููุงุช ุฅุถุงููุฉ

---

**ุงูุชุงุฑูุฎ:** ููุงูุฑ 2025  
**ุงููุญูู:** AI Assistant  
**ุงูุญุงูุฉ:** ุฌุงูุฒ ููุชูููุฐ ๐
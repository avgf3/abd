# ุชูุฑูุฑ ุฅุตูุงุญ ูุธุงู ุงูุฃุตุฏูุงุก ๐ง

## ููุฎุต ุงููุดุงูู ุงูููุชุดูุฉ โ

### 1. ุทุฑู ููููุฏุฉ ูู Storage Service

**ุงููุดููุฉ:** ููู `server/storage.ts` ูุงู ููุชูุฑ ููุทุฑู ุงูุชุงููุฉ:

- `getIncomingFriendRequests()`
- `getOutgoingFriendRequests()`
- `getFriendship()`
- `sendFriendRequest()`
- `removeFriend()`

**ุงูุณุจุจ:** API routes ูุงูุช ุชุญุงูู ุงุณุชุฏุนุงุก ูุฐู ุงูุทุฑู ูููููุง ุบูุฑ ููุฌูุฏุฉ

### 2. ุนุฏู ุชุทุงุจู ูู ุชุณููุฉ ุงูุจูุงูุงุช

**ุงููุดููุฉ:** ุนุฏู ุชุทุงุจู ุจูู Frontend ูุงูู Backend ูู ุชุณููุฉ ุงูุฎุตุงุฆุต:

- Backend ูุงู ููุฑุฌุน `sender` ู `receiver`
- Frontend ูุงู ูุชููุน `user`

**ุงููููุงุช ุงููุชุฃุซุฑุฉ:**

- `server/services/friendService.ts`
- `client/src/components/chat/FriendsTabPanel.tsx`

## ุงูุฅุตูุงุญุงุช ุงููููุฌุฒุฉ โ

### 1. ุฅุถุงูุฉ ุงูุทุฑู ุงูููููุฏุฉ ูู Storage

```typescript
// ูู server/storage.ts
async getIncomingFriendRequests(userId: number) {
  return await friendService.getIncomingFriendRequests(userId);
},

async getOutgoingFriendRequests(userId: number) {
  return await friendService.getOutgoingFriendRequests(userId);
},

async getFriendship(userId1: number, userId2: number) {
  return await friendService.getFriendship(userId1, userId2);
},

async sendFriendRequest(senderId: number, receiverId: number) {
  return await friendService.createFriendRequest(senderId, receiverId);
},

async removeFriend(userId: number, friendId: number) {
  return await friendService.removeFriend(userId, friendId);
}
```

### 2. ุชูุญูุฏ ุชุณููุฉ ุงูุจูุงูุงุช

```typescript
// ูู server/services/friendService.ts - ุทูุจุงุช ูุงุฑุฏุฉ
return incomingRequests.map((req) => ({
  id: req.id,
  userId: req.userId,
  friendId: req.friendId,
  status: req.status,
  createdAt: req.createdAt,
  user: {
    // ุชุบููุฑ ูู sender ุฅูู user
    id: req.userId,
    username: req.senderUsername,
    profileImage: req.senderProfileImage,
    userType: req.senderUserType,
    usernameColor: req.senderUsernameColor,
  },
}));

// ูู server/services/friendService.ts - ุทูุจุงุช ุตุงุฏุฑุฉ
return outgoingRequests.map((req) => ({
  id: req.id,
  userId: req.userId,
  friendId: req.friendId,
  status: req.status,
  createdAt: req.createdAt,
  user: {
    // ุชุบููุฑ ูู receiver ุฅูู user
    id: req.friendId,
    username: req.receiverUsername,
    profileImage: req.receiverProfileImage,
    userType: req.receiverUserType,
    usernameColor: req.receiverUsernameColor,
  },
}));
```

## ุงูููุฒุงุช ุงููููุนูุฉ ุงูุขู ๐

### 1. ุฅุฑุณุงู ุทูุจุงุช ุงูุตุฏุงูุฉ โ

- ูููู ูููุณุชุฎุฏููู ุฅุฑุณุงู ุทูุจุงุช ุตุฏุงูุฉ ูู ุฎูุงู UserPopup
- API endpoint: `POST /api/friend-requests`

### 2. ุนุฑุถ ุทูุจุงุช ุงูุตุฏุงูุฉ โ

- ุทูุจุงุช ูุงุฑุฏุฉ: `GET /api/friend-requests/incoming/:userId`
- ุทูุจุงุช ุตุงุฏุฑุฉ: `GET /api/friend-requests/outgoing/:userId`
- ุนุฑุถ ุตุญูุญ ูู FriendsTabPanel

### 3. ูุจูู/ุฑูุถ ุทูุจุงุช ุงูุตุฏุงูุฉ โ

- ูุจูู: `POST /api/friend-requests/:requestId/accept`
- ุฑูุถ: `POST /api/friend-requests/:requestId/decline`
- ุชุญุฏูุซ ููุฑู ูููุงุฌูุฉ

### 4. ุนุฑุถ ูุงุฆูุฉ ุงูุฃุตุฏูุงุก โ

- ุฌูุจ ูุงุฆูุฉ ุงูุฃุตุฏูุงุก: `GET /api/friends/:userId`
- ุนุฑุถ ุญุงูุฉ ุงูุงุชุตุงู (ูุชุตู/ุบูุฑ ูุชุตู)
- ุฅููุงููุฉ ุงูุจุญุซ ูู ุงููุงุฆูุฉ

### 5. ุญุฐู ุงูุฃุตุฏูุงุก โ

- ุญุฐู ุตุฏูู: `DELETE /api/friends/:userId/:friendId`
- ุชุญุฏูุซ ููุฑู ูููุงุฆูุฉ

### 6. ูุญุงุฏุซุฉ ุฎุงุตุฉ ูุน ุงูุฃุตุฏูุงุก โ

- ุจุฏุก ูุญุงุฏุซุฉ ุฎุงุตุฉ ูู ูุงุฆูุฉ ุงูุฃุตุฏูุงุก
- ุฒุฑ ูุญุงุฏุซุฉ ููู ุตุฏูู

## ุญุงูุฉ ุงููุธุงู ุงูุญุงููุฉ ๐

| ุงูููุฒุฉ              | ุงูุญุงูุฉ  | ููุงุญุธุงุช                        |
| ------------------- | ------- | ------------------------------ |
| ุฅุฑุณุงู ุทูุจ ุตุฏุงูุฉ     | โ ูุนูู | ูู UserPopup ู UserContextMenu |
| ุนุฑุถ ุงูุทูุจุงุช ุงููุงุฑุฏุฉ | โ ูุนูู | ูุน badge ููุนุฏุฏ                 |
| ุนุฑุถ ุงูุทูุจุงุช ุงูุตุงุฏุฑุฉ | โ ูุนูู | ูุน ุญุงูุฉ ุงูุทูุจ                  |
| ูุจูู ุงูุทูุจุงุช        | โ ูุนูู | ูุน ุฅุดุนุงุฑุงุช                     |
| ุฑูุถ ุงูุทูุจุงุช         | โ ูุนูู | ูุน ุฅุดุนุงุฑุงุช                     |
| ูุงุฆูุฉ ุงูุฃุตุฏูุงุก      | โ ูุนูู | ูุน ุญุงูุฉ ุงูุงุชุตุงู                |
| ุญุฐู ุงูุฃุตุฏูุงุก        | โ ูุนูู | ูุน ุชุฃููุฏ                       |
| ุงูุจุญุซ ูู ุงูุฃุตุฏูุงุก   | โ ูุนูู | ุจุญุซ ููุฑู                       |
| ูุญุงุฏุซุฉ ุฎุงุตุฉ         | โ ูุนูู | ุงูุชูุงู ูุจุงุดุฑ                   |

## ูููุงุช ุชู ุชุนุฏูููุง ๐

1. **server/storage.ts** - ุฅุถุงูุฉ ุทุฑู ููููุฏุฉ
2. **server/services/friendService.ts** - ุชูุญูุฏ ุชุณููุฉ ุงูุจูุงูุงุช

## ุงุฎุชุจุงุฑ ุงููุธุงู ๐งช

ุชู ุฅูุดุงุก ููู ุงุฎุชุจุงุฑ: `test-friends-system.js`

ูุชุดุบูู ุงูุงุฎุชุจุงุฑ:

```bash
node test-friends-system.js
```

## ุงูุชูุตูุงุช ๐ก

1. **ุงุฎุชุจุงุฑ ุดุงูู:** ุชุดุบูู ุงุฎุชุจุงุฑ ุงููุธุงู ููุชุฃูุฏ ูู ุนูู ุฌููุน ุงูููุฒุงุช
2. **ูุฑุงูุจุฉ ุงูุฃุฏุงุก:** ูุฑุงูุจุฉ ุฃุฏุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุน ุฒูุงุฏุฉ ุนุฏุฏ ุงูุฃุตุฏูุงุก
3. **ุฅุถุงูุงุช ูุณุชูุจููุฉ:**
   - ุฅุถุงูุฉ ุญุฏ ุฃูุตู ูุนุฏุฏ ุงูุฃุตุฏูุงุก
   - ุฅุถุงูุฉ ููุชุฑุฉ ุงูุฃุตุฏูุงุก ุญุณุจ ุงูุญุงูุฉ
   - ุฅุถุงูุฉ ูุฌููุนุงุช ุฃุตุฏูุงุก

## ุฎูุงุตุฉ ๐ฏ

ุชู ุฅุตูุงุญ ูุธุงู ุงูุฃุตุฏูุงุก ุจุงููุงูู! ุฌููุน ุงูููุฒุงุช ุชุนูู ุงูุขู ุจุดูู ุตุญูุญ:

- โ ุฅุฑุณุงู ููุจูู/ุฑูุถ ุทูุจุงุช ุงูุตุฏุงูุฉ
- โ ุนุฑุถ ูุงุฆูุฉ ุงูุฃุตุฏูุงุก ูุน ุญุงูุฉ ุงูุงุชุตุงู
- โ ุญุฐู ุงูุฃุตุฏูุงุก
- โ ุงูุจุญุซ ูู ุงููุงุฆูุฉ
- โ ุจุฏุก ูุญุงุฏุซุงุช ุฎุงุตุฉ

ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู! ๐

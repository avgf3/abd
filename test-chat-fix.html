<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø´Ø§Øª</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #1a1a1a;
            color: white;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #333;
            border-radius: 5px;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .info { color: #2196F3; }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        pre {
            background-color: #2a2a2a;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø¹Ø§Ù…</h1>
    
    <div class="test-section">
        <h2>ğŸ“¡ Ø§Ø®ØªØ¨Ø§Ø± API Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</h2>
        <button onclick="testMessagesAPI()">Ø§Ø®ØªØ¨Ø§Ø± API Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ø§Ù…Ø©</button>
        <button onclick="testGeneralRoomAPI()">Ø§Ø®ØªØ¨Ø§Ø± API ØºØ±ÙØ© Ø¹Ø§Ù…Ø©</button>
        <div id="api-results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ”— Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…</h2>
        <button onclick="testServerConnection()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</button>
        <div id="connection-results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…</h2>
        <div id="server-status">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</div>
    </div>

    <script>
        async function testMessagesAPI() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML = '<p class="info">Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± API Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ø§Ù…Ø©...</p>';
            
            try {
                const response = await fetch('/api/messages/public?limit=5');
                const data = await response.json();
                
                if (response.ok) {
                    resultsDiv.innerHTML = `
                        <p class="success">âœ… API Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ø§Ù…Ø© ÙŠØ¹Ù…Ù„</p>
                        <p class="info">Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: ${data.messages?.length || 0}</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultsDiv.innerHTML = `<p class="error">âŒ ÙØ´Ù„ ÙÙŠ API Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ø§Ù…Ø©: ${response.status}</p>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<p class="error">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}</p>`;
            }
        }

        async function testGeneralRoomAPI() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML = '<p class="info">Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± API ØºØ±ÙØ© Ø¹Ø§Ù…Ø©...</p>';
            
            try {
                const response = await fetch('/api/messages/room/general?limit=5');
                const data = await response.json();
                
                if (response.ok) {
                    const generalMessages = data.messages?.filter(msg => msg.roomId === 'general') || [];
                    resultsDiv.innerHTML = `
                        <p class="success">âœ… API ØºØ±ÙØ© Ø¹Ø§Ù…Ø© ÙŠØ¹Ù…Ù„</p>
                        <p class="info">Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙÙŠ Ø§Ù„ØºØ±ÙØ© Ø§Ù„Ø¹Ø§Ù…Ø©: ${generalMessages.length}</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultsDiv.innerHTML = `<p class="error">âŒ ÙØ´Ù„ ÙÙŠ API ØºØ±ÙØ© Ø¹Ø§Ù…Ø©: ${response.status}</p>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<p class="error">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}</p>`;
            }
        }

        async function testServerConnection() {
            const resultsDiv = document.getElementById('connection-results');
            resultsDiv.innerHTML = '<p class="info">Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…...</p>';
            
            try {
                const response = await fetch('/api/health');
                if (response.ok) {
                    resultsDiv.innerHTML = '<p class="success">âœ… Ø§Ù„Ø®Ø§Ø¯Ù… Ù…ØªØµÙ„ ÙˆÙŠØ¹Ù…Ù„</p>';
                } else {
                    resultsDiv.innerHTML = `<p class="error">âŒ Ø§Ù„Ø®Ø§Ø¯Ù… ØºÙŠØ± Ù…ØªØµÙ„: ${response.status}</p>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<p class="error">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}</p>`;
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù… ÙƒÙ„ 10 Ø«ÙˆØ§Ù†Ù
        async function updateServerStatus() {
            const statusDiv = document.getElementById('server-status');
            try {
                const response = await fetch('/api/health');
                if (response.ok) {
                    statusDiv.innerHTML = '<p class="success">ğŸŸ¢ Ø§Ù„Ø®Ø§Ø¯Ù… Ù…ØªØµÙ„ ÙˆÙŠØ¹Ù…Ù„</p>';
                } else {
                    statusDiv.innerHTML = '<p class="error">ğŸ”´ Ø§Ù„Ø®Ø§Ø¯Ù… ØºÙŠØ± Ù…ØªØµÙ„</p>';
                }
            } catch (error) {
                statusDiv.innerHTML = '<p class="error">ğŸ”´ Ø§Ù„Ø®Ø§Ø¯Ù… ØºÙŠØ± Ù…ØªØµÙ„</p>';
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù… Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        updateServerStatus();
        setInterval(updateServerStatus, 10000);
    </script>
</body>
</html>
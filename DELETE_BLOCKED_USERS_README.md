# سكريپت حذف المستخدمين المحظورين 🗑️

هذا السكريپت يسمح بحذف جميع المستخدمين المحظورين من قاعدة البيانات نهائياً.

## ⚠️ تحذير هام

**هذا السكريپت يحذف البيانات نهائياً ولا يمكن التراجع عنه!**

عند تشغيل السكريپت سيتم:
- حذف جميع المستخدمين المحظورين من قاعدة البيانات
- حذف جميع رسائلهم وتفاعلاتهم
- حذف منشورات الحائط وتفاعلاتها
- حذف الحالات (Stories) ومشاهداتها
- حذف علاقات الصداقة
- حذف الإشعارات
- حذف تاريخ النقاط
- تنظيف جدول الأجهزة المحجوبة

## 🚀 كيفية الاستخدام

### 1. البحث عن المستخدمين المحظورين أولاً
```bash
npm run find-blocked-users
```
هذا الأمر سيعرض لك قائمة بجميع المستخدمين المحظورين حالياً.

### 2. تشغيل سكريپت الحذف
```bash
npm run delete-blocked-users
```

### 3. اتباع التعليمات
السكريپت سيطلب منك تأكيدين:
1. **التأكيد الأول**: اكتب `yes` أو `y` أو `نعم`
2. **التأكيد النهائي**: اكتب `DELETE` أو `حذف`

## 📋 مثال على التشغيل

```bash
$ npm run delete-blocked-users

🔍 البحث عن المستخدمين المحظورين...

⚠️  تم العثور على 3 مستخدم محظور:

1. 👤 مستخدم_محظور1 (ID: 123)
   📧 النوع: member
   🌐 عنوان IP: 192.168.1.100
   📱 معرف الجهاز: device123
   📅 تاريخ الانضمام: 15/1/2024
   ──────────────────────────────────────────────────

2. 👤 مستخدم_محظور2 (ID: 456)
   📧 النوع: guest
   🌐 عنوان IP: غير متوفر
   📱 معرف الجهاز: غير متوفر
   📅 تاريخ الانضمام: 20/1/2024
   ──────────────────────────────────────────────────

🚨 تحذير هام:
• سيتم حذف هؤلاء المستخدمين نهائياً من قاعدة البيانات
• سيتم حذف جميع رسائلهم وبياناتهم
• سيتم تنظيف جدول الأجهزة المحجوبة
• هذا الإجراء لا يمكن التراجع عنه!

❓ هل أنت متأكد من أنك تريد حذف جميع المستخدمين المحظورين؟ (yes/y/نعم): yes

⚠️  تأكيد نهائي: اكتب "DELETE" أو "حذف" لتأكيد حذف 3 مستخدم محظور: DELETE

🚀 بدء عملية الحذف...

🗑️  حذف المستخدم: مستخدم_محظور1 (ID: 123)...
   ✅ تم حذف مستخدم_محظور1 بنجاح

🗑️  حذف المستخدم: مستخدم_محظور2 (ID: 456)...
   ✅ تم حذف مستخدم_محظور2 بنجاح

🧹 تنظيف جدول الأجهزة المحجوبة...
✅ تم تنظيف 2 جهاز محجوب

============================================================
📊 تقرير العملية:
✅ تم حذف: 3 مستخدم
❌ فشل في الحذف: 0 مستخدم
📋 إجمالي المحظورين: 3 مستخدم
============================================================

🎉 تمت العملية بنجاح!
✨ تم تنظيف قاعدة البيانات من جميع المستخدمين المحظورين

🔍 التحقق النهائي...
✅ تأكيد: لا يوجد مستخدمين محظورين في قاعدة البيانات

✅ انتهى السكريپت
```

## 🔧 أوامر إضافية

### إلغاء حظر مستخدم واحد
```bash
npm run unblock-user
```
هذا الأمر سيلغي حظر مستخدم محدد بدلاً من حذفه.

## 🛡️ ميزات الأمان

- **تأكيد مزدوج**: يطلب السكريپت تأكيدين منفصلين
- **عرض تفصيلي**: يعرض جميع المستخدمين قبل الحذف
- **تقرير نهائي**: يعرض إحصائيات العملية
- **التحقق النهائي**: يتأكد من اكتمال العملية
- **معالجة الأخطاء**: يتعامل مع الأخطاء بشكل آمن

## 🚫 حالات الإلغاء

يمكنك إلغاء العملية في أي وقت بالضغط على `Ctrl+C` أو بكتابة أي شيء غير المطلوب في التأكيدات.

## 📝 ملاحظات

- السكريپت يعمل فقط مع قاعدة بيانات PostgreSQL
- يتم حذف جميع البيانات المرتبطة بالمستخدمين المحظورين
- العملية قد تستغرق وقتاً حسب عدد المستخدمين والبيانات
- يُنصح بأخذ نسخة احتياطية قبل التشغيل

## 🆘 في حالة وجود مشاكل

إذا واجهت أي مشاكل:

1. تأكد من اتصال قاعدة البيانات
2. تأكد من وجود الصلاحيات المطلوبة
3. راجع رسائل الخطأ في الكونسول
4. تأكد من أن `DATABASE_URL` محدد بشكل صحيح

---

**تذكر: هذا السكريپت للاستخدام الإداري فقط ويجب توخي الحذر عند استخدامه!** ⚠️
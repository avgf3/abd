#!/bin/bash

# ุณูุฑูุจุช ุฅุตูุงุญ ูุดููุฉ ุงูุชุฐุจุฐุจ ูู ุงูููู ุงูุดุฎุตู
echo "๐ง ุจุฏุก ุฅุตูุงุญ ูุดููุฉ ุงูุชุฐุจุฐุจ ูู ุงูููู ุงูุดุฎุตู..."

# ุชุทุจูู migration ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
echo "๐ ุชุทุจูู migration ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช..."
psql $DATABASE_URL -f fix-profile-flickering-migration.sql

if [ $? -eq 0 ]; then
    echo "โ ุชู ุชุทุจูู migration ุจูุฌุงุญ"
else
    echo "โ ูุดู ูู ุชุทุจูู migration"
    exit 1
fi

# ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู ูุชุทุจูู ุงูุชุบููุฑุงุช
echo "๐ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู..."
pm2 restart all

if [ $? -eq 0 ]; then
    echo "โ ุชู ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู ุจูุฌุงุญ"
else
    echo "โ ูุดู ูู ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู"
    exit 1
fi

echo "๐ ุชู ุฅุตูุงุญ ูุดููุฉ ุงูุชุฐุจุฐุจ ุจูุฌุงุญ!"
echo ""
echo "๐ ููุฎุต ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ:"
echo "1. โ ููุน ุงูุชุญุฏูุซุงุช ุงููุชูุฑุฑุฉ ูู ProfileModal"
echo "2. โ ุชุญุณูู ูุนุงูุฌุฉ currentRoom ูู ุงููุงุด"
echo "3. โ ุฅุตูุงุญ ูุนุงูุฌุฉ ุฃุญุฏุงุซ Socket.IO"
echo "4. โ ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุถูุงู ุงุณุชูุฑุงุฑ ุงูุจูุงูุงุช"
echo "5. โ ุชุญุณูู ูุนุงูุฌุฉ ุงููุทุงุน ุงูุงุชุตุงู"
echo ""
echo "๐ ุงูุขู ูุฌุจ ุฃู ูุนูู ุงูููู ุงูุดุฎุตู ุจุดูู ูุณุชูุฑ ุฏูู ุชุฐุจุฐุจ!"
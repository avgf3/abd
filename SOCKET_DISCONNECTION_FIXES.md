# ุฅุตูุงุญ ูุดุงูู ุงููุทุงุน ุงูุงุชุตุงูุงุช ูู Socket.IO

## ๐ ุงููุดุงูู ุงูุชู ุชู ุญููุง:

### 1. **ุฅุนุฏุงุฏุงุช Ping/Pong ุบูุฑ ููุงุณุจุฉ ููู Free Tier**
- **ุงููุดููุฉ**: `pingTimeout: 60000` (ุฏูููุฉ ูุงุญุฏุฉ) ุทููู ุฌุฏุงู ููู free tier ูู Render.com
- **ุงูุญู**: ุชูููู ุฅูู `pingTimeout: 30000` (30 ุซุงููุฉ) ูู ุงูุฅูุชุงุฌ
- **ุงููุดููุฉ**: `pingInterval: 20000` ูุฏ ูููู ูุตูุฑุงู ุฌุฏุงู
- **ุงูุญู**: ุฒูุงุฏุฉ ุฅูู `pingInterval: 25000` (25 ุซุงููุฉ) ูู ุงูุฅูุชุงุฌ

### 2. **ุนุฏู ูุฌูุฏ ุขููุฉ Keep-Alive**
- **ุงููุดููุฉ**: ูุง ุชูุฌุฏ ุขููุฉ ููุญูุงุธ ุนูู ุงูุงุชุตุงู ูุดุทุงู
- **ุงูุญู**: ุฅุถุงูุฉ ping ุฏูุฑู ูู 20 ุซุงููุฉ ูู ุงูุนููู ููุฎุงุฏู

### 3. **ูุนุงูุฌุฉ ุถุนููุฉ ูุฃุณุจุงุจ ุงูุงููุทุงุน**
- **ุงููุดููุฉ**: ุงูุนููู ูุง ูููุฒ ุจูู ุฃููุงุน ุงูุงููุทุงุน ุงููุฎุชููุฉ
- **ุงูุญู**: ูุนุงูุฌุฉ ุฐููุฉ ูุฃุณุจุงุจ ุงูุงููุทุงุน:
  - `io server disconnect`: ูุง ูุญุงูู ุฅุนุงุฏุฉ ุงูุงุชุตุงู
  - `transport close` ุฃู `ping timeout`: ูุญุงูู ุฅุนุงุฏุฉ ุงูุงุชุตุงู

### 4. **ุฅุนุฏุงุฏุงุช ุฅุนุงุฏุฉ ุงูุงุชุตุงู ุบูุฑ ููุงุณุจุฉ ููู Free Tier**
- **ุงููุดููุฉ**: ูุญุงููุงุช ุฅุนุงุฏุฉ ุงุชุตุงู ูุซูุฑุฉ ูุฏ ุชุณุจุจ ุชุญููู ุฒุงุฆุฏ
- **ุงูุญู**: ุชูููู ุงููุญุงููุงุช ุฅูู 5 ูู ุงูุฅูุชุงุฌ ูุน ุชุฃุฎูุฑ ุฃุทูู

## ๐๏ธ ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ:

### ูู ุงูุฎุงุฏู (`server/realtime.ts`):
```typescript
// ุฅุนุฏุงุฏุงุช ping ูุญุณูุฉ ููู free tier
pingTimeout: (process?.env?.NODE_ENV === 'production') ? 30000 : 20000,
pingInterval: (process?.env?.NODE_ENV === 'production') ? 25000 : 15000,

// ุชุณุฌูู ููุช ุงูุงุชุตุงู ููุชุดุฎูุต
(socket as any).connectedAt = Date.now();

// ูุนุงูุฌุฉ ุฃูุถู ููุงููุทุงุน ูุน ุชุณุฌูู ุงูุณุจุจ
socket.on('disconnect', async (reason) => {
  console.log(`โ ุงููุทุงุน ุงุชุตุงู: ${socket.id} ุจุนุฏ ${Math.floor((Date.now() - (socket as any).connectedAt) / 1000)}s - ุงูุณุจุจ: ${reason}`);
  // ... ุจุงูู ุงููุนุงูุฌุฉ
});
```

### ูู ุงูุนููู (`client/src/lib/socket.ts`):
```typescript
// ุฅุนุฏุงุฏุงุช ุฅุนุงุฏุฉ ุงูุงุชุตุงู ูุญุณูุฉ ููู free tier
reconnectionAttempts: isProduction ? 5 : 3,
reconnectionDelay: isDevelopment ? 2000 : 3000,
reconnectionDelayMax: isProduction ? 15000 : 10000,
timeout: isDevelopment ? 20000 : 25000,

// ุขููุฉ Keep-Alive
const keepAliveInterval = setInterval(() => {
  if (socket.connected) {
    socket.emit('client_ping', { t: Date.now() });
  }
}, 20000);

// ูุนุงูุฌุฉ pong ูุน ูุฑุงูุจุฉ ุงููููู
socket.on('client_pong', (data) => {
  const latency = Date.now() - data.t;
  if (latency > 5000) {
    console.warn(`ูููู ุนุงูู: ${latency}ms`);
  }
});
```

### ูู ุงูุนููู (`client/src/hooks/useChat.ts`):
```typescript
// ูุนุงูุฌุฉ ุฐููุฉ ูุฃุณุจุงุจ ุงูุงููุทุงุน
s.on('disconnect', (reason) => {
  console.log('๐ ุงููุทุน ุงูุงุชุตุงู:', reason);
  
  if (reason === 'io server disconnect') {
    // ูุทุน ูู ุงูุฎุงุฏู - ูุง ูุญุงูู ุฅุนุงุฏุฉ ุงูุงุชุตุงู
    dispatch({ type: 'SET_CONNECTION_ERROR', payload: 'ุชู ูุทุน ุงูุงุชุตุงู ูู ุงูุฎุงุฏู' });
    return;
  }
  
  if (reason === 'transport close' || reason === 'ping timeout') {
    // ูุทุน ุงุชุตุงู ุบูุฑ ูุชููุน - ูุญุงูู ุฅุนุงุฏุฉ ุงูุงุชุตุงู
    dispatch({ type: 'SET_CONNECTION_ERROR', payload: 'ุงููุทุน ุงูุงุชุตุงู - ูุญุงููุฉ ุฅุนุงุฏุฉ ุงูุงุชุตุงู...' });
    
    setTimeout(() => {
      if (!s.connected) {
        s.connect();
      }
    }, 2000);
  }
});
```

## ๐ ุงููุชุงุฆุฌ ุงููุชููุนุฉ:

1. **ุชูููู ุงููุทุงุน ุงูุงุชุตุงูุงุช**: ุงูุฅุนุฏุงุฏุงุช ุงููุญุณูุฉ ููู free tier ุณุชููู ูู ุงูุงููุทุงุนุงุช ุบูุฑ ุงููุชููุนุฉ
2. **ุฅุนุงุฏุฉ ุงุชุตุงู ุฃุณุฑุน**: ุขููุฉ Keep-Alive ุณุชูุชุดู ุงูุงููุทุงุนุงุช ุจุณุฑุนุฉ ุฃูุจุฑ
3. **ูุนุงูุฌุฉ ุฐููุฉ**: ุงูุชูููุฒ ุจูู ุฃููุงุน ุงูุงููุทุงุน ุณูุญุณู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู
4. **ุงุณุชูุฑุงุฑ ุฃูุถู**: ุชูููู ุงููุญุงููุงุช ุงูููุฑุทุฉ ูุฅุนุงุฏุฉ ุงูุงุชุตุงู ุณูููู ูู ุงูุชุญููู ุนูู ุงูุฎุงุฏู

## ๐ง ูุตุงุฆุญ ุฅุถุงููุฉ:

1. **ูุฑุงูุจุฉ ุงูุฃุฏุงุก**: ุฑุงูุจ ุณุฌูุงุช ุงูุฎุงุฏู ูุฑุคูุฉ ุชุญุณู ูู ุงุณุชูุฑุงุฑ ุงูุงุชุตุงูุงุช
2. **ุงุฎุชุจุงุฑ ุงูุงุชุตุงู**: ุงุฎุชุจุฑ ุงูุชุทุจูู ูู ุธุฑูู ุดุจูุฉ ูุฎุชููุฉ
3. **ูุฑุงูุจุฉ ุงููููู**: ุฑุงูุจ ุชุญุฐูุฑุงุช ุงููููู ุงูุนุงูู ูู ูุญุฏุฉ ุงูุชุญูู
4. **ุชุญุฏูุซ ุฏูุฑู**: ุฑุงูุจ ุฅุตุฏุงุฑุงุช Socket.IO ููุญุตูู ุนูู ุชุญุณููุงุช ุฌุฏูุฏุฉ

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ:

1. ูุดุฑ ุงูุชุญุฏูุซุงุช ุนูู ุงูุฎุงุฏู
2. ูุฑุงูุจุฉ ุงูุณุฌูุงุช ููุฏุฉ 24-48 ุณุงุนุฉ
3. ุฌูุน ููุงุญุธุงุช ุงููุณุชุฎุฏููู ุญูู ุงุณุชูุฑุงุฑ ุงูุงุชุตุงู
4. ุถุจุท ุงูุฅุนุฏุงุฏุงุช ุญุณุจ ุงูุญุงุฌุฉ ุจูุงุกู ุนูู ุงูุจูุงูุงุช ุงููุฌูุนุฉ
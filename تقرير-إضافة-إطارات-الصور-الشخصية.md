# تقرير إضافة نظام إطارات الصور الشخصية

## الملخص
تم إضافة نظام متكامل لإطارات الصور الشخصية (Avatar Frames) للمستخدمين مع إمكانية إضافة الإطارات بواسطة الأونر فقط.

## التغييرات المنفذة

### 1. قاعدة البيانات
- **إضافة عامود جديد**: `avatar_frame` في جدول `users`
  - النوع: `TEXT`
  - القيمة الافتراضية: `'none'`
  - الملفات المحدثة:
    - `/server/database-adapter.ts` - تحديث جدول المستخدمين
    - `/server/services/databaseService.ts` - إضافة `avatarFrame` إلى interface

### 2. API Endpoints
- **Endpoint جديد**: `POST /api/users/:id/avatar-frame`
  - للأونر فقط
  - يقبل `{ frame: string }`
  - يرسل إشعار real-time لجميع المتصلين
  - الملف: `/server/routes.ts`

### 3. واجهة المستخدم

#### أ. Component جديد للصور مع الإطارات
- **الملف**: `/client/src/components/ui/AvatarWithFrame.tsx`
- **الميزات**:
  - عرض الصور الشخصية مع إطارات SVG
  - أحجام متعددة: sm, md, lg, xl
  - قائمة بجميع الإطارات المتاحة (حالياً 14 إطار)

#### ب. Component محدث لقائمة المستخدمين
- **الملف**: `/client/src/components/chat/UserListItemWithFrame.tsx`
- **الميزات**:
  - عرض الإطار مع الصورة الشخصية
  - دعم التأثيرات والألوان
  - عرض مؤشر الاتصال

#### ج. تحديث UserPopup
- **الملف**: `/client/src/components/chat/UserPopup.tsx`
- **الإضافات**:
  - زر "إضافة إطار" للأونر فقط
  - Dialog لاختيار الإطار مع معاينة
  - تصنيف الإطارات حسب النوع

### 4. الإطارات المتاحة

#### إطارات التاج TOP (6 إطارات):
- `enhanced-crown-frame` - تاج ذهبي TOP
- `crown-frame-silver` - تاج فضي TOP
- `crown-frame-rosegold` - تاج ذهبي وردي TOP
- `crown-frame-blue` - تاج أزرق TOP
- `crown-frame-emerald` - تاج زمردي TOP
- `crown-frame-purple` - تاج بنفسجي TOP

#### إطارات الأجنحة VIP:
- (غير متوفرة حالياً، سيتم إضافتها لاحقاً عند توفر الأصول)

#### إطارات خاصة (4 إطارات):
- `wings-frame-king` - أجنحة الملك KING
- `wings-frame-queen` - أجنحة الملكة QUEEN
- `crown-frame-classic-gold` - تاج كلاسيكي ذهبي
- `crown-frame-classic-coolpink` - تاج كلاسيكي وردي

#### إطارات SVIP (4 إطارات):
- `svip1-frame-gold` - SVIP1 ذهبي
- `svip1-frame-pink` - SVIP1 وردي
- `svip2-frame-gold` - SVIP2 ذهبي
- `svip2-frame-pink` - SVIP2 وردي

### 5. الأمان والصلاحيات
- فقط الأونر يمكنه إضافة/تغيير الإطارات
- التحقق من الصلاحيات في الـ API
- التحقق من صحة الإطار المختار

### 6. التحديثات الفورية
- عند تغيير إطار مستخدم، يتم إرسال إشعار real-time
- جميع المتصلين يرون التحديث فوراً
- Event: `user_frame_updated`

## خطوات التطبيق

### 1. تشغيل migration لإضافة العامود الجديد:
```bash
npx tsx server/scripts/add-avatar-frame-column.ts
```

### 2. التأكد من وجود ملفات SVG في:
```
/client/public/
```

### 3. إعادة تشغيل السيرفر

## الاستخدام

### للأونر:
1. النقر على اسم أي مستخدم
2. اختيار "إضافة إطار" من القائمة
3. اختيار الإطار المناسب من القائمة المصنفة
4. النقر على "تحديث الإطار"

### للمستخدمين:
- سيظهر الإطار تلقائياً حول صورهم الشخصية في:
  - قائمة المتصلين
  - الملف الشخصي
  - الرسائل
  - أي مكان آخر يعرض الصورة الشخصية

## ملاحظات مهمة
1. الإطارات عبارة عن ملفات SVG لضمان الجودة العالية
2. الإطارات تتكيف مع أحجام الصور المختلفة
3. يمكن إزالة الإطار باختيار "بدون إطار"
4. الإطارات محفوظة في قاعدة البيانات وتظهر حتى بعد إعادة الدخول

## التوافقية
- متوافق مع جميع المتصفحات الحديثة
- يعمل على الأجهزة المحمولة
- لا يؤثر على الأداء بفضل استخدام SVG
#!/bin/bash

# ููู ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช ุงูุดุงููุฉ ููุบุฑู ูุงูุฏุฑุฏุดุฉ
echo "๐ ุจุฏุก ุชุดุบูู ุงุฎุชุจุงุฑุงุช ุงููุธุงู ุงููุญุณู..."
echo "======================================="

# ุงูุชุญูู ูู ูุฌูุฏ Node.js
if ! command -v node &> /dev/null; then
    echo "โ Node.js ุบูุฑ ูุซุจุช. ูุฑุฌู ุชุซุจูุช Node.js ุฃููุงู."
    exit 1
fi

# ุงูุชุญูู ูู ูุฌูุฏ npm
if ! command -v npm &> /dev/null; then
    echo "โ npm ุบูุฑ ูุชููุฑ. ูุฑุฌู ุชุซุจูุช npm ุฃููุงู."
    exit 1
fi

# ุชุซุจูุช ุงูุชุจุนูุงุช ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ
if [ ! -d "node_modules" ]; then
    echo "๐ฆ ุชุซุจูุช ุงูุชุจุนูุงุช..."
    npm install
fi

# ุงูุชุญูู ูู ูุฌูุฏ socket.io-client
if ! npm list socket.io-client &> /dev/null; then
    echo "๐ฆ ุชุซุจูุช socket.io-client..."
    npm install socket.io-client
fi

echo ""
echo "๐ง ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช ุงูุดุงููุฉ..."
echo "================================"
echo ""

# ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช
node test-rooms-comprehensive-fixed.js

# ุงูุชุญูู ูู ูุชูุฌุฉ ุงูุงุฎุชุจุงุฑุงุช
if [ $? -eq 0 ]; then
    echo ""
    echo "๐ ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ูุฌุญุช!"
    echo "========================="
    echo "โ ุงููุธุงู ูุนูู ุจุดูู ูุซุงูู"
    echo "โ ุงูุบุฑู ุชุนูู ุจุดูู ุตุญูุญ"
    echo "โ ุงูุฏุฑุฏุดุฉ ุงูุนุงูุฉ ุชุนูู"
    echo "โ ุงูุฑุณุงุฆู ุงูุฎุงุตุฉ ุชุนูู"
    echo "โ ุงูุถูุงู ููุบุงุฏุฑุฉ ุงูุบุฑู ูุนูู"
else
    echo ""
    echo "โ๏ธ ุจุนุถ ุงูุงุฎุชุจุงุฑุงุช ูุดูุช"
    echo "========================"
    echo "โ ูุฑุฌู ูุฑุงุฌุนุฉ ุงูุฃุฎุทุงุก ุฃุนูุงู"
    echo "๐ง ูุฏ ุชุญุชุงุฌ ูุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู"
    exit 1
fi
const fs = require('fs');
const path = require('path');

console.log('๐ ูุญุต ุจุณูุท ููุดููุฉ ุงููุณุชุฎุฏููู ุงููุนูููู...');

// ูุญุงููุฉ ูุฑุงุกุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุญููุฉ
const dbPath = path.join(__dirname, 'chat.db');

if (fs.existsSync(dbPath)) {
  const stats = fs.statSync(dbPath);
  console.log(`๐ ุญุฌู ูุงุนุฏุฉ ุงูุจูุงูุงุช: ${stats.size} ุจุงูุช`);
  
  if (stats.size === 0) {
    console.log('โ๏ธ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงุฑุบุฉ - ูุฐุง ูุฏ ูููู ุณุจุจ ุงููุดููุฉ');
  }
} else {
  console.log('โ ูู ูุชู ุงูุนุซูุฑ ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุญููุฉ');
}

// ูุญุต ูููุงุช ุงูุฎุงุฏู ููุจุญุซ ุนู connectedUsers
const serverPath = path.join(__dirname, 'server', 'routes.ts');
if (fs.existsSync(serverPath)) {
  const content = fs.readFileSync(serverPath, 'utf8');
  
  // ุงูุจุญุซ ุนู ุชุนุฑูู connectedUsers
  const connectedUsersMatch = content.match(/const connectedUsers = new Map<number, {[\s\S]*?}>\(\);/);
  if (connectedUsersMatch) {
    console.log('โ ุชู ุงูุนุซูุฑ ุนูู ุชุนุฑูู connectedUsers ูู ุงูุฎุงุฏู');
  }
  
  // ุงูุจุญุซ ุนู ูุชุฑุฉ ุงูุชูุธูู
  const cleanupMatch = content.match(/}, (\d+)\); \/\/ ูู ุฏูููุชูู/);
  if (cleanupMatch) {
    const interval = parseInt(cleanupMatch[1]);
    console.log(`โฐ ูุชุฑุฉ ุงูุชูุธูู ุงูุญุงููุฉ: ${interval / 1000} ุซุงููุฉ (${interval / 60000} ุฏูููุฉ)`);
    
    if (interval >= 120000) {
      console.log('๐จ ุงููุดููุฉ ุงููุญุชููุฉ: ูุชุฑุฉ ุงูุชูุธูู ุทูููุฉ ุฌุฏุงู!');
      console.log('๐ก ูุฌุจ ุชูููู ูุชุฑุฉ ุงูุชูุธูู ุฅูู 30-60 ุซุงููุฉ ูุญู ูุดููุฉ ุงููุณุชุฎุฏููู ุงููุนูููู');
    }
  }
  
  // ุงูุจุญุซ ุนู ุนุฏุฏ ูุฑุงุช ุงุณุชุฎุฏุงู connectedUsers
  const usageCount = (content.match(/connectedUsers\./g) || []).length;
  console.log(`๐ ุงุณุชุฎุฏุงู connectedUsers ูู ุงูููุฏ: ${usageCount} ูุฑุฉ`);
  
} else {
  console.log('โ ูู ูุชู ุงูุนุซูุฑ ุนูู ููู routes.ts');
}

console.log(`
๐ฏ ุชุญููู ูุดููุฉ ุงูู 19 ูุณุชุฎุฏู ุงููุนูููู:

๐ ุงูุฃุณุจุงุจ ุงููุญุชููุฉ:
1. โ ูุชุฑุฉ ุงูุชูุธูู ุงูุฏูุฑู ุทูููุฉ ุฌุฏุงู (120 ุซุงููุฉ)
2. โ ุนุฏู ุฅุฒุงูุฉ ุงููุณุชุฎุฏููู ููุฑุงู ุนูุฏ ุงููุทุงุน ุงูุงุชุตุงู
3. โ ุชุถุงุฑุจ ุจูู connectedUsers ู ูุงุนุฏุฉ ุงูุจูุงูุงุช
4. โ ุนุฏู ุชูุธูู Socket connections ุงููููุทุนุฉ

๐ก ุงูุญููู ุงูููุชุฑุญุฉ:
1. ุชูููู ูุชุฑุฉ ุงูุชูุธูู ูู 120 ุซุงููุฉ ุฅูู 30 ุซุงููุฉ
2. ุฅุถุงูุฉ ุชูุธูู ููุฑู ุนูุฏ ุงููุทุงุน ุงูุงุชุตุงู
3. ุชุญุณูู ุขููุฉ ุงูุชุญูู ูู ุตุญุฉ ุงูุงุชุตุงูุงุช
4. ุฅุถุงูุฉ heartbeat ุฃุณุฑุน ูููุดู ุนู ุงูุงุชุตุงูุงุช ุงููููุทุนุฉ
`);
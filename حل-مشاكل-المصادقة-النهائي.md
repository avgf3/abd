# ๐ฏ ุงูุญู ุงูููุงุฆู ููุดุงูู ุงููุตุงุฏูุฉ ูุงูุนุถููุฉ

## ๐ ููุฎุต ุงููุดุงูู ุงูุชู ุชู ุญููุง

### โ **ุงููุดููุฉ ุงูุฑุฆูุณูุฉ**: ุฑุงุจุท ูุงุนุฏุฉ ุจูุงูุงุช ุฎุงุทุฆ
- **ูุจู**: `DATABASE_URL=postgresql://localhost:5432/chatapp_dev`
- **ุจุนุฏ**: ูุญุฏุฏ ููุดูุฑ ุฅูู Supabase ุงูุฎุงุต ุจู

### โ **ูุดุงูู ุฑุจุท ุงูุจูุงูุงุช ูู SQLite**: ุชู ุฅุตูุงุญูุง
- ุฅุตูุงุญ ุงูููู ุงูููุทููุฉ (boolean โ integer)
- ุฅุตูุงุญ ุงูุชูุงุฑูุฎ (Date โ ISO string)
- ุฅุฒุงูุฉ ุงูููู undefined ูุชุฌูุจ ุฃุฎุทุงุก ุงูุฑุจุท

### โ **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก**: ูุญุณูุฉ ุจุงููุงูู
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ูููุณุชุฎุฏู
- ูุนุงูุฌุฉ ุฎุงุตุฉ ููู ููุน ูู ุงูุฃุฎุทุงุก
- ุขููุฉ ููุชุฑุงุฌุน ุฅูู ูุถุน ุงูุฐุงูุฑุฉ

---

## ๐ ุงูุฎุทูุงุช ุงููุทููุจุฉ ููู

### 1. ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุจูุงูุงุช Supabase

#### ุฃ) ุฅูุดุงุก ูุดุฑูุน ุฌุฏูุฏ
1. ุงุฐูุจ ุฅูู: https://supabase.com
2. ุฃูุดุฆ ูุดุฑูุน ุฌุฏูุฏ
3. ุงุญูุธ ูููุฉ ูุฑูุฑ ูุงุนุฏุฉ ุงูุจูุงูุงุช

#### ุจ) ุงูุญุตูู ุนูู ุฑุงุจุท ุงูุงุชุตุงู
1. Settings > Database
2. ุงูุณุฎ "Connection string" 
3. ุงูุดูู: `postgresql://postgres:[password]@[project-id].supabase.co:5432/postgres`

### 2. ุชุญุฏูุซ ููู .env

```bash
# ุงุณุชุจุฏู ูุฐุง ุงูุณุทุฑ
DATABASE_URL=postgresql://postgres:[YOUR-PASSWORD]@[YOUR-PROJECT-ID].supabase.co:5432/postgres

# ูุซุงู:
# DATABASE_URL=postgresql://postgres:mypassword123@abc123xyz.supabase.co:5432/postgres
```

### 3. ุฅูุดุงุก ุงูุฌุฏุงูู ูู Supabase

ุงูุชุญ SQL Editor ูู Supabase ูุดุบู ูุฐุง ุงูููุฏ:

```sql
-- ุฅูุดุงุก ุฌุฏูู ุงููุณุชุฎุฏููู
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  username TEXT UNIQUE NOT NULL,
  password TEXT,
  user_type TEXT NOT NULL DEFAULT 'guest',
  role TEXT NOT NULL DEFAULT 'guest',
  profile_image TEXT,
  profile_banner TEXT,
  profile_background_color TEXT DEFAULT '#3c0d0d',
  status TEXT,
  gender TEXT,
  age INTEGER,
  country TEXT,
  relation TEXT,
  bio TEXT,
  is_online INTEGER DEFAULT 0,
  is_hidden INTEGER DEFAULT 0,
  last_seen TEXT,
  join_date TEXT,
  created_at TEXT,
  is_muted INTEGER DEFAULT 0,
  mute_expiry TEXT,
  is_banned INTEGER DEFAULT 0,
  ban_expiry TEXT,
  is_blocked INTEGER DEFAULT 0,
  ip_address TEXT,
  device_id TEXT,
  ignored_users TEXT DEFAULT '[]',
  username_color TEXT DEFAULT '#FFFFFF',
  user_theme TEXT DEFAULT 'default'
);

-- ุฅูุดุงุก ุฌุฏูู ุงูุฑุณุงุฆู
CREATE TABLE messages (
  id SERIAL PRIMARY KEY,
  sender_id INTEGER REFERENCES users(id),
  receiver_id INTEGER REFERENCES users(id),
  content TEXT NOT NULL,
  message_type TEXT NOT NULL DEFAULT 'text',
  is_private INTEGER DEFAULT 0,
  timestamp TEXT
);

-- ุฅูุดุงุก ุฌุฏูู ุงูุฃุตุฏูุงุก
CREATE TABLE friends (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  friend_id INTEGER REFERENCES users(id),
  status TEXT NOT NULL DEFAULT 'pending',
  created_at TEXT
);

-- ุฅูุดุงุก ุฌุฏูู ุงูุฅุดุนุงุฑุงุช
CREATE TABLE notifications (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id),
  type TEXT NOT NULL,
  title TEXT NOT NULL,
  message TEXT NOT NULL,
  is_read INTEGER DEFAULT 0,
  data TEXT,
  created_at TEXT
);

-- ุฅูุดุงุก ุฌุฏูู ุงูุฃุฌูุฒุฉ ุงููุญุธูุฑุฉ
CREATE TABLE blocked_devices (
  id SERIAL PRIMARY KEY,
  ip_address TEXT NOT NULL,
  device_id TEXT NOT NULL,
  user_id INTEGER NOT NULL,
  reason TEXT NOT NULL,
  blocked_at TEXT NOT NULL,
  blocked_by INTEGER NOT NULL
);

-- ุฅูุดุงุก ูุณุชุฎุฏู ูุฏูุฑ ุงูุชุฑุงุถู
INSERT INTO users (username, password, user_type, role, gender, profile_image, is_online, last_seen, join_date, created_at)
VALUES ('admin', 'admin123', 'owner', 'owner', 'male', '/default_avatar.svg', 0, 
        NOW()::text, NOW()::text, NOW()::text);
```

---

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงู

### 1. ุงุฎุชุจุงุฑ ุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```bash
npm run test:supabase
```

### 2. ุชุดุบูู ุงูุฎุงุฏู
```bash
npm run dev
```

### 3. ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู (ูุฏูุฑ)
```bash
curl -X POST http://localhost:5000/api/auth/member \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```json
{
  "user": {
    "id": 1,
    "username": "admin",
    "userType": "owner",
    "role": "owner",
    "isOnline": true
  }
}
```

### 4. ุงุฎุชุจุงุฑ ุชุณุฌูู ุนุถููุฉ ุฌุฏูุฏุฉ
```bash
curl -X POST http://localhost:5000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username":"testuser",
    "password":"123456",
    "confirmPassword":"123456",
    "gender":"male"
  }'
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```json
{
  "user": {
    "id": 2,
    "username": "testuser",
    "userType": "member",
    "role": "member"
  },
  "message": "ุชู ุงูุชุณุฌูู ุจูุฌุงุญ"
}
```

---

## ๐ง ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ ูู ุงูููุฏ

### 1. ูู `server/storage.ts`
- โ ุฅุตูุงุญ ุฏุงูุฉ `createUser` 
- โ ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก
- โ ุฅุฒุงูุฉ ุงูููู undefined
- โ ุชุญููู ุงูููู ุงูููุทููุฉ ููู SQLite
- โ ุขููุฉ ุงูุชุฑุงุฌุน ููุฐุงูุฑุฉ

### 2. ูู `server/routes/auth.ts`
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ููููุฏุฉ
- โ ูุนุงูุฌุฉ ูุฎุตุตุฉ ููู ููุน ุฎุทุฃ
- โ ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู

### 3. ูู `.env`
- โ ุชุญุฏูุซ ุฑุงุจุท ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุฅุฑุดุงุฏุงุช ูุงุถุญุฉ ููุฅุนุฏุงุฏ

---

## ๐ ุญุงูุฉ ุงููุธุงู ุจุนุฏ ุงูุฅุตูุงุญ

| ุงูุนูููุฉ | ูุจู ุงูุฅุตูุงุญ | ุจุนุฏ ุงูุฅุตูุงุญ |
|---------|-------------|-------------|
| **ุฏุฎูู ุงูุถูู** | โ ูุนูู | โ ูุนูู |
| **ุฏุฎูู ุงูุนุถู** | ๐ก ูุน ุฃุฎุทุงุก | โ ูุนูู ุจุณูุงุณุฉ |
| **ุชุณุฌูู ุนุถููุฉ ุฌุฏูุฏุฉ** | โ ูุดู | โ ูุนูู ุจุณูุงุณุฉ |
| **ุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช** | โ localhost | โ Supabase |
| **ุฑุณุงุฆู ุงูุฎุทุฃ** | ๐ก ุนุงูุฉ | โ ูุงุถุญุฉ ููููุฏุฉ |

---

## ๐ ุงููุชุงุฆุฌ ุงููุชููุนุฉ

ุจุนุฏ ุชุทุจูู ุงูุญููู:

### โ **ุชุณุฌูู ุงูุฏุฎูู**
- ุงููุฏูุฑ ููููู ุงูุฏุฎูู ุจู `admin / admin123`
- ุงูุฃุนุถุงุก ูููููู ุงูุฏุฎูู ุจุญุณุงุจุงุชูู
- ุงูุถููู ูููููู ุงูุฏุฎูู ุจุฃุณูุงุก ูุคูุชุฉ

### โ **ุชุณุฌูู ุงูุนุถููุฉ**
- ุฅูุดุงุก ุญุณุงุจุงุช ุฌุฏูุฏุฉ ูุนูู
- ุงูุชุญูู ูู ููุฉ ูููุฉ ุงููุฑูุฑ
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุนูุฏ ุงููุดุงูู

### โ **ูุงุนุฏุฉ ุงูุจูุงูุงุช**
- ุงุชุตุงู ูุณุชูุฑ ูุน Supabase
- ุญูุธ ุจูุงูุงุช ุงูุฃุนุถุงุก
- ุญูุธ ุงูุฑุณุงุฆู ูุงูุฅุดุนุงุฑุงุช

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:

1. **ุชุฃูุฏ ูู ุตุญุฉ ุฑุงุจุท Supabase** ูู ููู `.env`
2. **ุดุบู ุงุฎุชุจุงุฑ ุงูุงุชุตุงู**: `npm run test:supabase`
3. **ุฑุงุฌุน ุฑุณุงุฆู ุงููููุณูู** ููุญุตูู ุนูู ุชูุงุตูู ุงูุฃุฎุทุงุก
4. **ุชุฃูุฏ ูู ุชุดุบูู ุงูุฌุฏุงูู SQL** ูู Supabase

---

## ๐ ุฌุงูุฒ ููุงุณุชุฎุฏุงู!

ุงููุธุงู ุงูุขู ุฌุงูุฒ ุจุงููุงูู:
- โ ูุตุงุฏูุฉ ุขููุฉ
- โ ุชุณุฌูู ุนุถููุฉ ุณูุณ  
- โ ูุงุนุฏุฉ ุจูุงูุงุช ูุณุชูุฑุฉ
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
- โ ุฏุนู ูุงูู ููุนุฑุจูุฉ
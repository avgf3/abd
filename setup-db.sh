#!/bin/bash

# سكريبت إعداد تلقائي لمشروع الدردشة العربية
# يطلب من المستخدم رابط قاعدة البيانات ويضبطه في ملف .env
# ثم ينفذ أوامر التهيئة والبناء والتشغيل

set -e

# 1. طلب رابط الاتصال
read -p "ادخل رابط قاعدة بيانات PostgreSQL (DATABASE_URL): " DB_URL

if [[ -z "$DB_URL" ]]; then
  echo "[خطأ] يجب إدخال رابط قاعدة البيانات!"
  exit 1
fi

# 2. إنشاء ملف .env أو تحديثه
cat > .env <<EOF
DATABASE_URL="$DB_URL"
EOF

echo "[✔] تم حفظ رابط قاعدة البيانات في ملف .env"

# 3. تثبيت الحزم (إذا لم تكن مثبتة)
npm install

# 4. تهيئة الجداول
npm run db:push

# 5. بناء المشروع
npm run build

# 6. تشغيل الخادم
npm start
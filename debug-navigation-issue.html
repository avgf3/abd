<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø«Ø¨Ø§Øª Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© - Race Condition</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
            padding: 20px;
        }
        .navigation {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 56px;
            background: #2a2a2a;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            border-top: 2px solid #444;
        }
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 300px;
            height: 100vh;
            background: #333;
            padding: 20px;
            transition: all 0.3s;
        }
        .sidebar.hidden {
            transform: translateX(-100%);
        }
        .log-container {
            background: #222;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .log-entry {
            padding: 5px;
            margin: 2px 0;
            border-left: 3px solid #666;
        }
        .log-entry.error {
            border-color: red;
            background: rgba(255, 0, 0, 0.1);
        }
        .log-entry.success {
            border-color: green;
            background: rgba(0, 255, 0, 0.1);
        }
        .log-entry.warning {
            border-color: orange;
            background: rgba(255, 165, 0, 0.1);
        }
        button {
            padding: 10px 20px;
            background: #4a4a4a;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #5a5a5a;
        }
        .problem-indicator {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
        }
        .problem-detected {
            background: rgba(255, 0, 0, 0.3);
            border: 2px solid red;
        }
        .no-problem {
            background: rgba(0, 255, 0, 0.3);
            border: 2px solid green;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Ø¥Ø«Ø¨Ø§Øª Ù…Ø´ÙƒÙ„Ø© Race Condition ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h1>
    
    <div class="problem-indicator" id="problemIndicator">
        Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...
    </div>

    <h2>ğŸ“Š Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù…Ù† Ù…ÙˆÙ‚Ø¹Ùƒ:</h2>
    <div class="log-container" id="realScenarioLog"></div>

    <h2>ğŸ¯ Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</h2>
    <button onclick="simulateRaceCondition()">ğŸ”„ Ù…Ø­Ø§ÙƒØ§Ø© Race Condition</button>
    <button onclick="simulateNormalLoad()">âœ… Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ</button>
    <button onclick="clearLogs()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</button>
    
    <div class="log-container" id="logContainer"></div>

    <div class="sidebar" id="sidebar">
        <h3>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©</h3>
        <p>Ù‡Ø°Ù‡ ØªÙ…Ø«Ù„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†/Ø§Ù„ØºØ±Ù</p>
    </div>

    <div class="navigation">
        <button onclick="toggleSidebar()">ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</button>
        <button>ğŸ  Ø§Ù„ØºØ±Ù</button>
        <button>ğŸ“ Ø§Ù„Ø­Ø§Ø¦Ø·</button>
    </div>

    <script>
        let logId = 0;
        
        function log(message, type = 'info') {
            const container = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString('ar-EG', { 
                hour12: false, 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit',
                fractionalSecondDigits: 3 
            });
            entry.innerHTML = `[${timestamp}] ${message}`;
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
        }

        function realLog(message, type = 'info') {
            const container = document.getElementById('realScenarioLog');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString('ar-EG', { 
                hour12: false, 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit',
                fractionalSecondDigits: 3 
            });
            entry.innerHTML = `[${timestamp}] ${message}`;
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '';
            document.getElementById('realScenarioLog').innerHTML = '';
        }

        // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù…Ù† Ù…ÙˆÙ‚Ø¹Ùƒ
        class RealCodeSimulation {
            constructor() {
                // Ù…Ø­Ø§ÙƒØ§Ø© useState
                this.isMobile = false; // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ© Ø¯Ø§Ø¦Ù…Ø§Ù‹ false
                this.activeView = this.getInitialActiveView();
                
                realLog(`ğŸ”µ useState: isMobile = ${this.isMobile} (Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©)`, 'warning');
                realLog(`ğŸ”µ useState: activeView = '${this.activeView}' (Ù…Ø­Ø³ÙˆØ¨Ø© Ù…Ù† window.innerWidth)`, 'warning');
                
                // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ù€ render Ø§Ù„Ø£ÙˆÙ„
                this.firstRender();
                
                // Ù…Ø­Ø§ÙƒØ§Ø© useEffect (ÙŠØ­Ø¯Ø« Ø¨Ø¹Ø¯ Ø§Ù„Ù€ render)
                setTimeout(() => {
                    this.runUseEffect();
                }, 100); // ØªØ£Ø®ÙŠØ± ØµØºÙŠØ± ÙŠÙ…Ø«Ù„ Ø¯ÙˆØ±Ø© Ø§Ù„Ù€ React
            }
            
            getInitialActiveView() {
                const width = window.innerWidth;
                return width < 768 ? 'hidden' : 'users';
            }
            
            firstRender() {
                realLog(`ğŸ¨ FIRST RENDER:`, 'success');
                realLog(`  - isMobile = ${this.isMobile}`, 'info');
                realLog(`  - activeView = '${this.activeView}'`, 'info');
                
                const shouldShowSidebar = !this.isMobile || this.activeView === 'hidden';
                realLog(`  - Ø§Ù„Ø´Ø±Ø·: !isMobile || activeView === 'hidden'`, 'info');
                realLog(`  - Ø§Ù„Ù†ØªÙŠØ¬Ø©: !${this.isMobile} || '${this.activeView}' === 'hidden' = ${shouldShowSidebar}`, 
                    shouldShowSidebar ? 'error' : 'success');
                
                if (shouldShowSidebar && this.activeView !== 'hidden') {
                    realLog(`âŒ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø³ØªØ¸Ù‡Ø± Ø±ØºÙ… Ø£Ù†Ù†Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„!`, 'error');
                    document.getElementById('problemIndicator').className = 'problem-indicator problem-detected';
                    document.getElementById('problemIndicator').textContent = 'âš ï¸ ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ù…Ø´ÙƒÙ„Ø©! Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¸Ù‡Ø±Øª Ø®Ø·Ø£Ù‹';
                }
            }
            
            runUseEffect() {
                realLog(`âš¡ useEffect ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù† (Ø¨Ø¹Ø¯ Ø§Ù„Ù€ render):`, 'warning');
                
                // ÙØ­Øµ Ø­Ù‚ÙŠÙ‚ÙŠ Ù„Ù„Ø¬Ù‡Ø§Ø²
                const width = window.innerWidth;
                const userAgent = navigator.userAgent;
                const isMobileUserAgent = /Android|webOS|iPhone|iPad|iPod/i.test(userAgent);
                const isTouchDevice = 'ontouchstart' in window;
                
                this.isMobile = width <= 768 || (isMobileUserAgent && isTouchDevice);
                
                realLog(`  - ØªÙ… ØªØ­Ø¯ÙŠØ« isMobile Ø¥Ù„Ù‰: ${this.isMobile}`, 'success');
                realLog(`  - Ù„ÙƒÙ† Ø§Ù„Ù€ render Ø§Ù„Ø£ÙˆÙ„ Ø§Ù†ØªÙ‡Ù‰ Ø¨Ø§Ù„ÙØ¹Ù„!`, 'error');
                
                // Ø§Ù„Ø¢Ù† React Ø³ÙŠØ¹Ù…Ù„ re-render
                this.reRender();
            }
            
            reRender() {
                realLog(`ğŸ”„ RE-RENDER (Ø¨Ø¹Ø¯ ØªØ­Ø¯ÙŠØ« isMobile):`, 'success');
                realLog(`  - isMobile = ${this.isMobile} (Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø§Ù„Ø¢Ù†)`, 'success');
                realLog(`  - activeView = '${this.activeView}'`, 'info');
                
                const shouldShowSidebar = !this.isMobile || this.activeView === 'hidden';
                realLog(`  - Ø§Ù„Ø´Ø±Ø·: !${this.isMobile} || '${this.activeView}' === 'hidden' = ${shouldShowSidebar}`, 
                    shouldShowSidebar ? 'info' : 'success');
                
                if (!shouldShowSidebar) {
                    realLog(`âœ… Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ø®ØªÙØª Ø§Ù„Ø¢Ù† (Ù„ÙƒÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø±Ø¢Ù‡Ø§ Ù„Ù„Ø­Ø¸Ø©!)`, 'warning');
                }
            }
        }

        // Ù…Ø­Ø§ÙƒØ§Ø© Race Condition
        function simulateRaceCondition() {
            clearLogs();
            log('ğŸš€ Ø¨Ø¯Ø§ÙŠØ© Ù…Ø­Ø§ÙƒØ§Ø© Race Condition...', 'warning');
            log('');
            
            // Step 1: Initial State
            log('ğŸ“ Step 1: Initial State (useState)', 'success');
            let isMobile = false; // Ø¯Ø§Ø¦Ù…Ø§Ù‹ false ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            let activeView = window.innerWidth < 768 ? 'hidden' : 'users';
            
            log(`  isMobile = ${isMobile} (hardcoded ÙÙŠ use-mobile.tsx:4)`, 'error');
            log(`  activeView = '${activeView}' (Ù…Ù† window.innerWidth)`, 'info');
            log('');
            
            // Step 2: First Render
            log('ğŸ“ Step 2: First Render (Ù‚Ø¨Ù„ useEffect)', 'success');
            const condition1 = !isMobile || activeView === 'hidden';
            log(`  Ø§Ù„Ø´Ø±Ø·: !isMobile || activeView === 'hidden'`, 'info');
            log(`  Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: !${isMobile} || '${activeView}' === 'hidden' = ${condition1}`, condition1 ? 'error' : 'success');
            
            if (condition1 && activeView !== 'hidden') {
                log(`  âš ï¸ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ØªØ¸Ù‡Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„!`, 'error');
                document.getElementById('sidebar').classList.remove('hidden');
            }
            log('');
            
            // Step 3: useEffect runs (after render)
            setTimeout(() => {
                log('ğŸ“ Step 3: useEffect ÙŠØ´ØªØºÙ„ (Ø¨Ø¹Ø¯ 100ms)', 'success');
                
                // Ø§Ù„Ø¢Ù† Ù†ÙØ­Øµ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
                const width = window.innerWidth;
                const isMobileDevice = width <= 768;
                isMobile = isMobileDevice;
                
                log(`  isMobile Ù…Ø­Ø¯Ø« Ø¥Ù„Ù‰: ${isMobile} (Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©)`, 'success');
                log('');
                
                // Step 4: Re-render
                log('ğŸ“ Step 4: Re-render', 'success');
                const condition2 = !isMobile || activeView === 'hidden';
                log(`  Ø§Ù„Ø´Ø±Ø·: !isMobile || activeView === 'hidden'`, 'info');
                log(`  Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: !${isMobile} || '${activeView}' === 'hidden' = ${condition2}`, 'info');
                
                if (!condition2) {
                    log(`  Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ØªØ®ØªÙÙŠ Ø§Ù„Ø¢Ù†`, 'success');
                    document.getElementById('sidebar').classList.add('hidden');
                }
                
                log('');
                log('ğŸ¯ Ø§Ù„Ù†ØªÙŠØ¬Ø©: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø±Ø£Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù…Ø¯Ø© 100ms Ø«Ù… Ø§Ø®ØªÙØª!', 'error');
            }, 100);
        }

        function simulateNormalLoad() {
            clearLogs();
            log('âœ… Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ (Ø¨Ø¯ÙˆÙ† race condition)...', 'success');
            log('');
            
            // Ø§Ù„Ø­Ù„ Ø§Ù„ØµØ­ÙŠØ­: ØªÙ‡ÙŠØ¦Ø© isMobile Ø¨Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            const width = window.innerWidth;
            const isMobileInitial = width <= 768;
            
            log('ğŸ“ Ø§Ù„Ø­Ù„ Ø§Ù„ØµØ­ÙŠØ­:', 'success');
            log(`  const [isMobile] = useState(() => window.innerWidth <= 768)`, 'success');
            log(`  isMobile = ${isMobileInitial} (Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©)`, 'success');
            log('');
            log('âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´ÙƒÙ„Ø©! Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ù…Ù† Ø£ÙˆÙ„ render', 'success');
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('hidden');
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        window.addEventListener('load', () => {
            realLog('ğŸŒ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©...', 'info');
            realLog(`ğŸ“± Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ø´Ø©: ${window.innerWidth}px`, 'info');
            realLog(`ğŸ“± Ø§Ù„Ø¬Ù‡Ø§Ø²: ${window.innerWidth <= 768 ? 'Ù…ÙˆØ¨Ø§ÙŠÙ„' : 'Ø¯ÙŠØ³ÙƒØªÙˆØ¨'}`, 'info');
            realLog('');
            
            new RealCodeSimulation();
        });
    </script>
</body>
</html>
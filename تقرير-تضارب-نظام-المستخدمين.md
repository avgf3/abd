# ğŸš¨ ØªÙ‚Ø±ÙŠØ± ØªØ¶Ø§Ø±Ø¨ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†

## ğŸ” **Ø§Ù„ØªØ¶Ø§Ø±Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø§Ù„Ù…ÙƒØªØ´Ù**

### **1. ØªØ¶Ø§Ø±Ø¨ ÙÙŠ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†:**

#### **ğŸŸ¢ ChatUser (Client):**
```typescript
// ÙÙŠ client/src/types/chat.ts
export interface ChatUser {
  userType: 'guest' | 'member' | 'owner' | 'admin' | 'moderator';
  role: 'guest' | 'member' | 'owner' | 'admin' | 'moderator';
  // ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø®ØµØ§Ø¦Øµ
}
```

#### **ğŸ”´ User (Server):**
```typescript
// ÙÙŠ shared/schema.ts
export const users = pgTable("users", {
  userType: text("user_type").notNull().default("guest"), // 'guest', 'member', 'owner'
  role: text("role").notNull().default("guest"), // Ù†ÙØ³ userType Ù„Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ ChatUser
  // ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø®ØµØ§Ø¦Øµ
});
```

#### **ğŸŸ¡ AuthenticatedUser (API):**
```typescript
// ÙÙŠ server/types/api.ts
export interface AuthenticatedUser {
  userType: UserRole;
  // ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø®ØµØ§Ø¦Øµ
}

export type UserRole = 'guest' | 'member' | 'moderator' | 'admin' | 'owner';
```

---

## ğŸ“Š **Ù…Ù‚Ø§Ø±Ù†Ø© Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†**

| Ø§Ù„Ù…Ù„Ù | Ø§Ù„Ù†ÙˆØ¹ | Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø© |
|-------|-------|----------------|
| `ChatUser` | Client | `'guest' \| 'member' \| 'owner' \| 'admin' \| 'moderator'` |
| `User` | Server | `'guest' \| 'member' \| 'owner'` |
| `AuthenticatedUser` | API | `'guest' \| 'member' \| 'moderator' \| 'admin' \| 'owner'` |

### **ğŸš¨ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:**
- **ChatUser** ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ `'moderator'`
- **User** Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ `'moderator'`
- **AuthenticatedUser** ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ `'moderator'`

---

## ğŸ”§ **Ø§Ù„ØªØ¶Ø§Ø±Ø¨ ÙÙŠ Ø§Ù„Ø®ØµØ§Ø¦Øµ**

### **1. ØªØ¶Ø§Ø±Ø¨ ÙÙŠ profileEffect:**

#### **ChatUser (Client):**
```typescript
profileEffect?: string; // optional
```

#### **User (Server):**
```typescript
profileEffect: text("profile_effect").default('none'), // required
```

### **2. ØªØ¶Ø§Ø±Ø¨ ÙÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·:**

#### **ChatUser (Client):**
```typescript
points?: number; // optional
level?: number; // optional
totalPoints?: number; // optional
levelProgress?: number; // optional
```

#### **User (Server):**
```typescript
points: integer("points").default(0), // required
level: integer("level").default(1), // required
totalPoints: integer("total_points").default(0), // required
levelProgress: integer("level_progress").default(0), // required
```

---

## ğŸš¨ **Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø­Ø±Ø¬Ø©**

### **1. ØªØ¶Ø§Ø±Ø¨ ÙÙŠ userType:**
```typescript
// ÙÙŠ server/routes.ts - ÙŠØ³ØªØ®Ø¯Ù… 'moderator'
if (user.userType === 'moderator') { ... }

// ÙÙŠ shared/schema.ts - Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 'moderator'
userType: text("user_type").notNull().default("guest"), // 'guest', 'member', 'owner'
```

### **2. ØªØ¶Ø§Ø±Ø¨ ÙÙŠ role vs userType:**
```typescript
// ÙÙŠ shared/schema.ts - ØªØ¹Ù„ÙŠÙ‚ ÙŠÙ‚ÙˆÙ„ Ø£Ù†Ù‡Ø§ Ù…ØªØ·Ø§Ø¨Ù‚Ø©
role: text("role").notNull().default("guest"), // Ù†ÙØ³ userType Ù„Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ ChatUser

// Ù„ÙƒÙ† ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ - ÙŠØªÙ… Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡Ø§ Ø¨Ø´ÙƒÙ„ Ù…Ø®ØªÙ„Ù
if (user.userType !== 'admin' && user.userType !== 'owner') { ... }
```

### **3. ØªØ¶Ø§Ø±Ø¨ ÙÙŠ ignoredUsers:**
```typescript
// ÙÙŠ ChatUser (Client)
ignoredUsers: number[]; // array

// ÙÙŠ User (Server)
ignoredUsers: text("ignored_users").default('[]'), // JSON string
```

---

## ğŸ”„ **Ø§Ù„ØªØ¶Ø§Ø±Ø¨ ÙÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„**

### **1. ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Server Ø¥Ù„Ù‰ Client:**
```typescript
// ÙÙŠ server/services/messageService.ts
return {
  userType: msg.senderUserType || 'guest', // Ù‚Ø¯ ÙŠÙƒÙˆÙ† undefined
  // ...
};
```

### **2. ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Client Ø¥Ù„Ù‰ Server:**
```typescript
// ÙÙŠ server/storage.ts
userType: user.userType || 'guest', // fallback
role: user.role || user.userType || 'guest', // ØªØ¶Ø§Ø±Ø¨
```

---

## ğŸ¯ **Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©**

### **Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹**

#### **1. ØªØ­Ø¯ÙŠØ« shared/schema.ts:**
```typescript
export const users = pgTable("users", {
  userType: text("user_type").notNull().default("guest"), 
  // Ø¥Ø¶Ø§ÙØ© 'moderator' Ùˆ 'admin'
  // 'guest' | 'member' | 'moderator' | 'admin' | 'owner'
  
  role: text("role").notNull().default("guest"), 
  // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ - role Ùˆ userType Ù…Ø®ØªÙ„ÙØ§Ù†
  
  profileEffect: text("profile_effect").default('none'), // required
  
  ignoredUsers: text("ignored_users").default('[]'), // JSON string
  // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ array ÙÙŠ Client
});
```

#### **2. ØªØ­Ø¯ÙŠØ« ChatUser:**
```typescript
export interface ChatUser {
  userType: 'guest' | 'member' | 'moderator' | 'admin' | 'owner';
  role: 'guest' | 'member' | 'moderator' | 'admin' | 'owner';
  
  profileEffect: string; // required
  
  points: number; // required
  level: number; // required
  totalPoints: number; // required
  levelProgress: number; // required
  
  ignoredUsers: number[]; // array
}
```

### **Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ØªØ­ÙˆÙŠÙ„**

#### **1. Ø¥ØµÙ„Ø§Ø­ server/services:**
```typescript
// ØªØ­ÙˆÙŠÙ„ JSON string Ø¥Ù„Ù‰ array
ignoredUsers: JSON.parse(user.ignoredUsers || '[]'),

// ØªØ­ÙˆÙŠÙ„ array Ø¥Ù„Ù‰ JSON string
ignoredUsers: JSON.stringify(user.ignoredUsers || []),
```

#### **2. Ø¥ØµÙ„Ø§Ø­ server/storage.ts:**
```typescript
// ØªÙˆØ­ÙŠØ¯ userType Ùˆ role
userType: user.userType || 'guest',
role: user.role || user.userType || 'guest',
```

### **Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©: ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª**

#### **1. Ø¥Ø¶Ø§ÙØ© 'moderator' Ùˆ 'admin':**
```sql
-- ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ÙŠÙ†
UPDATE users SET user_type = 'moderator' WHERE user_type = 'member' AND role = 'moderator';
UPDATE users SET user_type = 'admin' WHERE user_type = 'member' AND role = 'admin';
```

#### **2. Ø¥ØµÙ„Ø§Ø­ profileEffect:**
```sql
-- ØªØ­Ø¯ÙŠØ« profileEffect Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ÙŠÙ†
UPDATE users SET profile_effect = 'none' WHERE profile_effect IS NULL;
```

---

## ğŸ“Š **Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹**

### **Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­:**
- âœ… **ØªÙˆØ­ÙŠØ¯ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†**
- âœ… **Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ¶Ø§Ø±Ø¨ ÙÙŠ Ø§Ù„Ø®ØµØ§Ø¦Øµ**
- âœ… **ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨ÙŠÙ† Client Ùˆ Server**
- âœ… **ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Runtime**

### **Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ ØªØ­Ø¯ÙŠØ«:**
1. `shared/schema.ts` - ØªØ­Ø¯ÙŠØ« Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
2. `client/src/types/chat.ts` - ØªÙˆØ­ÙŠØ¯ ChatUser
3. `server/services/*.ts` - Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ØªØ­ÙˆÙŠÙ„
4. `server/storage.ts` - Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ØªÙˆØ­ÙŠØ¯
5. `server/routes.ts` - Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª

---

## âœ… **Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©**
- **Ù†Ø¸Ø§Ù… Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…ÙˆØ­Ø¯**
- **Ø£Ù‚Ù„ Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Runtime**
- **ØµÙŠØ§Ù†Ø© Ø£Ø³Ù‡Ù„**
- **ØªØ·ÙˆÙŠØ± Ø£Ø³Ø±Ø¹**
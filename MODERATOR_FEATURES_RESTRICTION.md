# تقييد الميزات للمشرفين فقط

## التغييرات المنفذة

تم تقييد الميزات التالية بحيث تكون متاحة للمشرفين فقط (Owner, Admin, Moderator):

### 1. إضافة الصور في الدردشة
- **الملف المعدل**: `client/src/components/chat/MediaUploadButton.tsx`
- **الملف المعدل**: `client/src/components/chat/ComposerPlusMenu.tsx`
- **الملف المعدل**: `client/src/components/chat/MessageArea.tsx`
- **التغيير**: إضافة فحص الصلاحيات قبل السماح برفع الصور

### 2. تغيير صورة البروفايل
- **الملف المعدل**: `client/src/components/profile/ProfileImageUpload.tsx`
- **الملف المعدل**: `client/src/components/chat/ProfileModal.tsx`
- **الملف المعدل**: `server/routes.ts` (مسار `/api/upload/profile-image`)
- **التغيير**: منع الزوار من رفع أو تغيير صورة البروفايل

### 3. تغيير صورة الغلاف (البانر)
- **الملف المعدل**: `client/src/components/chat/ProfileModal.tsx`
- **الملف المعدل**: `server/routes.ts` (مسار `/api/upload/profile-banner`)
- **التغيير**: إخفاء زر تغيير الغلاف للزوار

### 4. إضافة التأثيرات والألوان
- **الملف المعدل**: `client/src/components/chat/ProfileModal.tsx`
- **الملف المعدل**: `server/routes.ts` (مسار `PUT /api/users/:id`)
- **التغيير**: منع الزوار من تغيير التأثيرات والألوان

### 5. تغيير لون الاسم
- **الملف المعدل**: `client/src/components/chat/SettingsMenu.tsx`
- **الملف المعدل**: `server/routes.ts` (مسار `/api/users/:userId/username-color`)
- **التغيير**: إخفاء خيار تغيير لون الاسم للزوار

### 6. إضافة الموسيقى للملف الشخصي
- **الملف المعدل**: `client/src/components/chat/ProfileModal.tsx`
- **الملف المعدل**: `server/routes.ts` (مسار `/api/upload/profile-music`)
- **التغيير**: منع الزوار من رفع أو تعديل موسيقى البروفايل

### 7. إضافة الستوري (الحالات)
- **الملف المعدل**: `client/src/components/ui/StoriesSettings.tsx`
- **الملف المعدل**: `client/src/components/chat/SettingsMenu.tsx`
- **الملف المعدل**: `server/routes/stories.ts`
- **التغيير**: منع الزوار من رفع الستوري وإخفاء الزر من القائمة

## آلية العمل

### من جهة العميل (Frontend)
1. يتم التحقق من نوع المستخدم (`userType`) قبل عرض الأزرار والخيارات
2. إذا لم يكن المستخدم مشرفاً، يتم إخفاء الأزرار أو عرض رسالة توضيحية
3. يتم عرض رسالة خطأ عند محاولة استخدام الميزة بطرق أخرى

### من جهة الخادم (Backend)
1. يتم التحقق من نوع المستخدم في كل مسار API
2. إذا لم يكن المستخدم مشرفاً، يتم إرجاع خطأ 403 (Forbidden)
3. يتم حذف الملفات المرفوعة إذا لم يكن للمستخدم الصلاحية

## أنواع المستخدمين المسموح لهم

- **owner**: المالك
- **admin**: المشرف العام
- **moderator**: المشرف

## أنواع المستخدمين الممنوعين

- **guest**: الزائر
- **member**: العضو العادي

## ملاحظات مهمة

1. **الأمان**: التحقق يتم من جهتي العميل والخادم لضمان الأمان الكامل
2. **تجربة المستخدم**: يتم إخفاء الخيارات غير المتاحة بدلاً من تعطيلها فقط
3. **رسائل الخطأ**: رسائل واضحة باللغة العربية توضح أن الميزة للمشرفين فقط
4. **التوافق**: التغييرات متوافقة مع النظام الحالي ولا تؤثر على الوظائف الأخرى

## الاختبار

للتأكد من عمل التغييرات:

1. قم بتسجيل الدخول كزائر أو عضو عادي
2. تحقق من عدم ظهور الأزرار التالية:
   - زر إضافة صورة في الدردشة
   - زر تغيير صورة البروفايل
   - زر تغيير صورة الغلاف
   - خيارات التأثيرات والألوان
   - خيار لون الاسم
   - خيار الموسيقى
   - خيار الستوري

3. قم بتسجيل الدخول كمشرف
4. تحقق من ظهور جميع الخيارات وعملها بشكل طبيعي

## الصيانة المستقبلية

عند إضافة ميزات جديدة، تأكد من:
1. إضافة فحص الصلاحيات في الواجهة الأمامية
2. إضافة فحص الصلاحيات في الخادم
3. توثيق التغييرات في هذا الملف
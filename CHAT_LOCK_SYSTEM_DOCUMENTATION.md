# ูุธุงู ููู ุงูุฏุฑุฏุดุฉ - ุฏููู ุดุงูู

## ูุธุฑุฉ ุนุงูุฉ
ุชู ุชุทููุฑ ูุธุงู ููู ุงูุฏุฑุฏุดุฉ ุงููุชูุฏู ููุณูุงุญ ูููุงูู ุจุงูุชุญูู ุงููุงูู ูู ุฅุนุฏุงุฏุงุช ุงูุฏุฑุฏุดุฉ ูู ุงูุบุฑู. ูููุฑ ุงููุธุงู ููุนูู ูู ุฃููุงู ุงูุฏุฑุฏุดุฉ ูุน ูุงุฌูุฉ ูุณุชุฎุฏู ุจุฏูููุฉ ูุชุญุฏูุซุงุช ููุฑูุฉ.

## ุงููุชุทูุจุงุช ูุงูุชุตููู

### ุฃููุงุน ููู ุงูุฏุฑุฏุดุฉ

#### 1. ุงูููู ุงููุงูู (Complete Lock)
- **ุงููุตู**: ูููุน ุฌููุน ุงููุณุชุฎุฏููู ูู ุฅุฑุณุงู ุงูุฑุณุงุฆู ุจุงุณุชุซูุงุก ุงููุงูู
- **ุงููุณุชุฎุฏููู ุงููุณููุญ ููู**: ุงููุงูู ููุท
- **ุงููุณุชุฎุฏููู ุงููุญุธูุฑูู**: ุฌููุน ุงููุณุชุฎุฏููู ุงูุขุฎุฑูู (ุฃุนุถุงุกุ ูุดุฑูููุ ุฅุฏุงุฑูููุ ุฒูุงุฑ)
- **ุงูุฑุณุงูุฉ ุงููุนุฑูุถุฉ**: "ูุฐู ุงูุฎุงุตูุฉ ุบูุฑ ูุชููุฑุฉ ุงูุขู"

#### 2. ููู ุงูุฒูุงุฑ (Visitor Lock)  
- **ุงููุตู**: ูููุน ุงูุฒูุงุฑ ููุท ูู ุฅุฑุณุงู ุงูุฑุณุงุฆู
- **ุงููุณุชุฎุฏููู ุงููุณููุญ ููู**: ุงููุงููุ ุงูุฅุฏุงุฑูููุ ุงููุดุฑูููุ ุงูุฃุนุถุงุก ุงููุณุฌููู
- **ุงููุณุชุฎุฏููู ุงููุญุธูุฑูู**: ุงูุฒูุงุฑ (guest users) ููุท
- **ุงูุฑุณุงูุฉ ุงููุนุฑูุถุฉ**: "ูุฐู ุงูุฎุงุตูุฉ ุบูุฑ ูุชููุฑุฉ ุงูุขู"

### ุงูุตูุงุญูุงุช
- **ุงูุชุญูู ูู ุงูููู**: ุงููุงูู ููุท
- **ุชุฌุงูุฒ ุงูููู**: ุงููุงูู ุฏุงุฆูุงู ูุณุชุทูุน ุฅุฑุณุงู ุงูุฑุณุงุฆู
- **ุงููุตูู ูุฅุนุฏุงุฏุงุช ุงูููู**: ุงููุงูู ููุท ุนุจุฑ ููุญุฉ ุงูุฅุฏุงุฑุฉ

## ุงูุชูููุฐ ุงูุชููู

### 1. ูุงุนุฏุฉ ุงูุจูุงูุงุช
```sql
-- ุฅุถุงูุฉ ุฃุนูุฏุฉ ููู ุงูุฏุฑุฏุดุฉ
ALTER TABLE "rooms" ADD COLUMN IF NOT EXISTS "chat_lock_all" boolean DEFAULT false;
ALTER TABLE "rooms" ADD COLUMN IF NOT EXISTS "chat_lock_visitors" boolean DEFAULT false;

-- ููุงุฑุณ ููุฃุฏุงุก
CREATE INDEX IF NOT EXISTS "idx_rooms_chat_lock_all" ON "rooms" ("chat_lock_all");
CREATE INDEX IF NOT EXISTS "idx_rooms_chat_lock_visitors" ON "rooms" ("chat_lock_visitors");
```

### 2. ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช (API)

#### ุชุญุฏูุซ ุฅุนุฏุงุฏุงุช ููู ุงูุฏุฑุฏุดุฉ
```typescript
PUT /api/rooms/:roomId/chat-lock
```

**ุงูุทูุจ**:
```json
{
  "chatLockAll": true,      // ุงุฎุชูุงุฑู
  "chatLockVisitors": false // ุงุฎุชูุงุฑู
}
```

**ุงูุงุณุชุฌุงุจุฉ**:
```json
{
  "success": true,
  "message": "ุชู ุชุญุฏูุซ ุฅุนุฏุงุฏุงุช ููู ุงูุฏุฑุฏุดุฉ ุจูุฌุงุญ",
  "room": { /* ุจูุงูุงุช ุงูุบุฑูุฉ ุงููุญุฏุซุฉ */ },
  "chatLockAll": true,
  "chatLockVisitors": false
}
```

### 3. ุงูุชุญูู ูู ุตุญุฉ ุงูุฑุณุงุฆู

#### ุนูู ูุณุชูู ุงูุฎุฏูุฉ (Service Layer)
```typescript
// ูู roomMessageService.ts
const isOwner = sender.userType === 'owner';
const isGuest = sender.userType === 'guest';

if (room.chatLockAll && !isOwner) {
  throw new Error('ุงูุฏุฑุฏุดุฉ ููููุฉ ูู ูุจู ุงููุงูู - ุบูุฑ ูุณููุญ ุจุฅุฑุณุงู ุงูุฑุณุงุฆู');
}

if (room.chatLockVisitors && isGuest && !isOwner) {
  throw new Error('ุงูุฏุฑุฏุดุฉ ููููุฉ ููุฒูุงุฑ - ูุฌุจ ุงูุชุณุฌูู ูุฅุฑุณุงู ุงูุฑุณุงุฆู');
}
```

#### ุนูู ูุณุชูู ุงููุณุงุฑุงุช (Route Layer)
```typescript
// ูู messages.ts
if (room.chatLockAll && !isOwner) {
  return res.status(403).json({ 
    error: 'ุงูุฏุฑุฏุดุฉ ููููุฉ ูู ูุจู ุงููุงูู',
    reason: 'chat_locked_all',
    message: 'ูุฐู ุงูุฎุงุตูุฉ ุบูุฑ ูุชููุฑุฉ ุงูุขู'
  });
}
```

### 4. ูุงุฌูุฉ ุงููุณุชุฎุฏู

#### ููุญุฉ ุฅุฏุงุฑุฉ ุงููุงูู
- ุชุจููุจ ุฌุฏูุฏ: "ููู ุงูุฏุฑุฏุดุฉ"
- ุจุทุงูุงุช ุชูุงุนููุฉ ููู ููุน ููู
- ูุคุดุฑุงุช ุจุตุฑูุฉ ููุญุงูุฉ ุงูุญุงููุฉ
- ุฃุฒุฑุงุฑ ุชูุนูู/ุฅูุบุงุก ูุน ุฃููุงู ูููุฒุฉ
- ูุนูููุงุช ุชูุถูุญูุฉ ุดุงููุฉ

#### ูุงุฌูุฉ ุงูุฏุฑุฏุดุฉ
- ูุคุดุฑ ุญุงูุฉ ุงูููู ูู ุฃุนูู ููุทูุฉ ุงูุฑุณุงุฆู
- ุชุนุทูู ุญูู ุงูุฅุฏุฎุงู ูุน ุฑุณุงูุฉ ูุงุถุญุฉ
- ุชุนุทูู ุฃุฒุฑุงุฑ ุงูุฅูููุฌู ูุงููุฑููุงุช
- ุชุนุทูู ุฒุฑ ุงูุฅุฑุณุงู ูุน ูุคุดุฑ ุจุตุฑู

### 5. ุงูุชุญุฏูุซุงุช ุงูููุฑูุฉ (Real-time Updates)

#### Socket Events
```typescript
// ุจุซ ุชุญุฏูุซ ููู ุงูุฏุฑุฏุดุฉ
io.to(`room_${roomId}`).emit('chatLockUpdated', {
  type: 'chatLockUpdated',
  roomId,
  chatLockAll: true,
  chatLockVisitors: false,
  updatedBy: ownerId,
  timestamp: new Date().toISOString()
});
```

#### ูุนุงูุฌุฉ ุงูุชุญุฏูุซุงุช ูู ุงูุนููู
```typescript
// ูู useChat.ts
socketInstance.on('chatLockUpdated', (message: any) => {
  emitToBroadcastHandlers({ type: 'chatLockUpdated', ...message });
});

// ูู ChatInterface.tsx
const onChatLockUpdate = (payload: any) => {
  if (payload.roomId && payload.roomId === chat.currentRoomId) {
    fetchRooms(true).catch(() => {});
  }
};
```

## ุฏููู ุงูุงุณุชุฎุฏุงู

### ูููุงูู

#### ุงููุตูู ูุฅุนุฏุงุฏุงุช ุงูููู
1. ุงุถุบุท ุนูู ุฃููููุฉ ุงูุชุงุฌ ุงูุฐูุจูุฉ (๐) ูู ุฃุณูู ูููู ุงูุดุงุดุฉ
2. ุงุฎุชุฑ ุชุจููุจ "ููู ุงูุฏุฑุฏุดุฉ"
3. ุชุฃูุฏ ูู ุฏุฎููู ูุบุฑูุฉ ุฃููุงู

#### ุชูุนูู ุงูููู ุงููุงูู
1. ูู ุจุทุงูุฉ "ููู ุงูุฏุฑุฏุดุฉ ุจุงููุงูู"
2. ุงุถุบุท ุนูู ุฒุฑ "ุชูุนูู ุงูููู"
3. ุณุชุธูุฑ ุฑุณุงูุฉ ุชุฃููุฏ ูุณูุชู ุชุทุจูู ุงูููู ููุฑุงู

#### ุชูุนูู ููู ุงูุฒูุงุฑ
1. ูู ุจุทุงูุฉ "ููู ุงูุฏุฑุฏุดุฉ ููุฒูุงุฑ ููุท"
2. ุงุถุบุท ุนูู ุฒุฑ "ุชูุนูู ุงูููู"
3. ุณูุชู ููุน ุงูุฒูุงุฑ ููุท ูู ุงูุฏุฑุฏุดุฉ

#### ุฅูุบุงุก ุงูููู
1. ุงุถุบุท ุนูู ุฒุฑ "ุฅูุบุงุก ุงูููู" ูู ุงูุจุทุงูุฉ ุงูููุงุณุจุฉ
2. ุณูุชู ุฅูุบุงุก ุงูููู ููุฑุงู

### ูููุณุชุฎุฏููู

#### ุนูุฏ ุชูุนูู ุงูููู
- ุณุชุธูุฑ ุฑุณุงูุฉ ุชูุจูู ูู ุฃุนูู ููุทูุฉ ุงูุฏุฑุฏุดุฉ
- ุณูุชู ุชุนุทูู ุญูู ุงูุฅุฏุฎุงู ูุน ุฑุณุงูุฉ "ูุฐู ุงูุฎุงุตูุฉ ุบูุฑ ูุชููุฑุฉ ุงูุขู"
- ุณุชุนุทู ุฌููุน ุฃุฒุฑุงุฑ ุงูุชูุงุนู (ุฅูููุฌูุ ูุฑููุงุชุ ุฅุฑุณุงู)

#### ุงููุคุดุฑุงุช ุงูุจุตุฑูุฉ
- **ุงูููู ุงููุงูู**: ุฎูููุฉ ุญูุฑุงุก ูุน ุฃููููุฉ ุงูููู
- **ููู ุงูุฒูุงุฑ**: ุฎูููุฉ ุตูุฑุงุก ูุน ุฃููููุฉ ุงููุณุชุฎุฏู ุงููุญุธูุฑ

## ุงูุฃูุงู ูุงูุญูุงูุฉ

### ุงูุชุญูู ูู ุงูุตูุงุญูุงุช
- ุฌููุน ุนูููุงุช ุชุญุฏูุซ ุงูููู ุชุชุทูุจ ุตูุงุญูุฉ ุงููุงูู
- ุงูุชุญูู ูุชู ุนูู ูุณุชูููู: ุงูุนููู ูุงูุฎุงุฏู
- ููุน ุชุฌุงูุฒ ุงููููุฏ ุนุจุฑ API ูุจุงุดุฑุฉ

### ุงูุญูุงูุฉ ูู ุงูุชูุงุนุจ
- ุงูุชุญูู ูู ููุน ุงููุณุชุฎุฏู ูู ูู ุทูุจ ุฑุณุงูุฉ
- ุงูุชุญูู ุงููุฒุฏูุฌ ูู ุงูุฎุฏูุฉ ูุงููุณุงุฑ
- ุฑุณุงุฆู ุฎุทุฃ ููุญุฏุฉ ูููุน ูุดู ุงููุนูููุงุช

### ุงูุฃุฏุงุก
- ููุงุฑุณ ูุงุนุฏุฉ ุจูุงูุงุช ููุจุญุซ ุงูุณุฑูุน
- ุชุญุฏูุซุงุช ููุฑูุฉ ุจุฏูู ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ
- ุฐุงูุฑุฉ ุชุฎุฒูู ูุคูุช ููุบุฑู ูุน ุชุญุฏูุซ ุฐูู

## ุงูุงุฎุชุจุงุฑ

### ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ ุงูุฃุณุงุณูุฉ

#### 1. ุงุฎุชุจุงุฑ ุงูููู ุงููุงูู
- [ ] ุงููุงูู ูุณุชุทูุน ุชูุนูู ุงูููู ุงููุงูู
- [ ] ุงููุงูู ูุณุชุทูุน ุฅุฑุณุงู ุฑุณุงุฆู ุฑุบู ุงูููู
- [ ] ุงูุฅุฏุงุฑููู ูุง ูุณุชุทูุนูู ุฅุฑุณุงู ุฑุณุงุฆู
- [ ] ุงููุดุฑููู ูุง ูุณุชุทูุนูู ุฅุฑุณุงู ุฑุณุงุฆู  
- [ ] ุงูุฃุนุถุงุก ูุง ูุณุชุทูุนูู ุฅุฑุณุงู ุฑุณุงุฆู
- [ ] ุงูุฒูุงุฑ ูุง ูุณุชุทูุนูู ุฅุฑุณุงู ุฑุณุงุฆู
- [ ] ุธููุฑ ุงููุคุดุฑ ุงูุฃุญูุฑ ููููู ุงููุงูู
- [ ] ุชุนุทูู ูุงุฌูุฉ ุงูุฅุฏุฎุงู ููุฌููุน ุนุฏุง ุงููุงูู

#### 2. ุงุฎุชุจุงุฑ ููู ุงูุฒูุงุฑ
- [ ] ุงููุงูู ูุณุชุทูุน ุชูุนูู ููู ุงูุฒูุงุฑ
- [ ] ุงููุงูู ูุณุชุทูุน ุฅุฑุณุงู ุฑุณุงุฆู
- [ ] ุงูุฅุฏุงุฑููู ูุณุชุทูุนูู ุฅุฑุณุงู ุฑุณุงุฆู
- [ ] ุงููุดุฑููู ูุณุชุทูุนูู ุฅุฑุณุงู ุฑุณุงุฆู
- [ ] ุงูุฃุนุถุงุก ูุณุชุทูุนูู ุฅุฑุณุงู ุฑุณุงุฆู
- [ ] ุงูุฒูุงุฑ ูุง ูุณุชุทูุนูู ุฅุฑุณุงู ุฑุณุงุฆู
- [ ] ุธููุฑ ุงููุคุดุฑ ุงูุฃุตูุฑ ูููู ุงูุฒูุงุฑ
- [ ] ุชุนุทูู ูุงุฌูุฉ ุงูุฅุฏุฎุงู ููุฒูุงุฑ ููุท

#### 3. ุงุฎุชุจุงุฑ ุงูุชุญุฏูุซุงุช ุงูููุฑูุฉ
- [ ] ุชุญุฏูุซ ููุฑู ุนูุฏ ุชุบููุฑ ุฅุนุฏุงุฏุงุช ุงูููู
- [ ] ุฅุดุนุงุฑ ุฌููุน ุงููุณุชุฎุฏููู ูู ุงูุบุฑูุฉ
- [ ] ุชุญุฏูุซ ูุงุฌูุฉ ุงููุณุชุฎุฏู ุจุฏูู ุฅุนุงุฏุฉ ุชุญููู
- [ ] ูุฒุงููุฉ ุงูุญุงูุฉ ุนุจุฑ ุนุฏุฉ ุนูุงูุงุช ุชุจููุจ

#### 4. ุงุฎุชุจุงุฑ ุงูุตูุงุญูุงุช
- [ ] ููุน ุบูุฑ ุงููุงูููู ูู ุงููุตูู ูุฅุนุฏุงุฏุงุช ุงูููู
- [ ] ููุน ุชุญุฏูุซ ุงูููู ุนุจุฑ API ูู ุบูุฑ ุงููุงูู
- [ ] ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ูู ูู ุทูุจ

### ุงุฎุชุจุงุฑุงุช ุงูุญุงูุฉ (Edge Cases)
- [ ] ุชุบููุฑ ุงูุบุฑูุฉ ุฃุซูุงุก ุชูุนูู ุงูููู
- [ ] ูุทุน ุงูุงุชุตุงู ูุฅุนุงุฏุฉ ุงูุงุชุตุงู
- [ ] ุชุญุฏูุซ ุตูุงุญูุงุช ุงููุณุชุฎุฏู ุฃุซูุงุก ุงูููู
- [ ] ุชูุนูู ุงูููููู ูุนุงู (ุงููุงูู ููุบู ููู ุงูุฒูุงุฑ)

## ุงูุตูุงูุฉ ูุงููุฑุงูุจุฉ

### ูุฑุงูุจุฉ ุงูุฃุฏุงุก
- ุชุชุจุน ุงุณุชุฎุฏุงู ุฅุนุฏุงุฏุงุช ุงูููู
- ูุฑุงูุจุฉ ุฃููุงุช ุงูุงุณุชุฌุงุจุฉ ููุชุญุฏูุซุงุช
- ุชุชุจุน ุงูุฃุฎุทุงุก ูุงูุงุณุชุซูุงุกุงุช

### ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ
- ุฅุถุงูุฉ ูุณุชููุงุช ููู ุฅุถุงููุฉ
- ุฌุฏููุฉ ุงูููู ุงูุชููุงุฆู
- ุฅุญุตุงุฆูุงุช ุงุณุชุฎุฏุงู ุงูููู
- ุณุฌู ุชุบููุฑุงุช ุงูููู

## ุงูุฎูุงุตุฉ

ุชู ุชุทููุฑ ูุธุงู ููู ุงูุฏุฑุฏุดุฉ ุจูุฌุงุญ ูุน ุฌููุน ุงููุชุทูุจุงุช ุงููุทููุจุฉ:

โ **ุชู ุงูุชูููุฐ ุจุงููุงูู**:
- ููู ุงูุฏุฑุฏุดุฉ ุจุงููุงูู (ุงููุงูู ููุท)
- ููู ุงูุฏุฑุฏุดุฉ ููุฒูุงุฑ
- ูุงุฌูุฉ ุฅุฏุงุฑุฉ ูุชูุฏูุฉ ูููุงูู
- ุชุญุฏูุซุงุช ููุฑูุฉ ุนุจุฑ Socket.IO
- ุญูุงูุฉ ุดุงููุฉ ุนูู ุฌููุน ุงููุณุชููุงุช
- ูุงุฌูุฉ ูุณุชุฎุฏู ุจุฏูููุฉ ููุชุฌุงูุจุฉ

ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูุฅูุชุงุฌู ููููุฑ ุชุญููุงู ูุงููุงู ูููุซููุงู ูู ุฅุฏุงุฑุฉ ุงูุฏุฑุฏุดุฉ.
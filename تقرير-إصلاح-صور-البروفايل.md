# ØªÙ‚Ø±ÙŠØ± Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© ØµÙˆØ± Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ÙˆØ§Ù„Ø¨Ø§Ù†Ø±

## ğŸ” Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù…ÙƒØªØ´ÙØ©

### Ø§Ù„ÙˆØµÙ

ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø¯Ø§Ù„Ø© `updateUser` ÙÙŠ Ù…Ù„Ù `server/storage-fixed.ts` Ø­ÙŠØ« Ø£Ù†Ù‡Ø§ Ù„Ø§ ØªØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ« ØµÙˆØ± Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ÙˆØ§Ù„Ø¨Ø§Ù†Ø±.

### Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ‚Ù†ÙŠØ©

- **Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ØªØ£Ø«Ø±:** `server/storage-fixed.ts`
- **Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©:** `updateUser(id: number, updates: Partial<User>)`
- **Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:** Ø§Ù„Ø¯Ø§Ù„Ø© ÙƒØ§Ù†Øª ØªØªØ­Ù‚Ù‚ ÙÙ‚Ø· Ù…Ù† `isOnline` Ùˆ `lastSeen` ÙˆÙ„Ø§ ØªØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø®Ø±Ù‰

### Ø§Ù„ÙƒÙˆØ¯ Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­

```typescript
async updateUser(id: number, updates: Partial<User>): Promise<User | undefined> {
  try {
    const directDb = getDirectSqliteConnection();

    // Build dynamic update query
    const setClause = [];
    const values = [];

    if (updates.isOnline !== undefined) {
      setClause.push('is_online = ?');
      values.push(updates.isOnline ? 1 : 0);
    }

    if (updates.lastSeen !== undefined) {
      setClause.push('last_seen = ?');
      values.push(updates.lastSeen ? updates.lastSeen.toISOString() : null);
    }

    if (setClause.length === 0) {
      return this.getUser(id);
    }

    values.push(id);
    const stmt = directDb.prepare(`UPDATE users SET ${setClause.join(', ')} WHERE id = ?`);
    stmt.run(...values);

    return this.getUser(id);
  } catch (error) {
    console.error('Error updating user:', error);
    return undefined;
  }
}
```

## âœ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ø·Ø¨Ù‚

### Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø¶Ø§ÙØ©

ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¯Ø¹Ù… Ù„ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©:

1. **ØµÙˆØ± Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ÙˆØ§Ù„Ø¨Ø§Ù†Ø±:**
   - `profileImage` â†’ `profile_image`
   - `profileBanner` â†’ `profile_banner`

2. **Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¸Ù‡Ø±:**
   - `profileBackgroundColor` â†’ `profile_background_color`
   - `usernameColor` â†’ `username_color`
   - `userTheme` â†’ `user_theme`
   - `profileEffect` â†’ `profile_effect`

3. **Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:**
   - `status` â†’ `status`
   - `bio` â†’ `bio`
   - `gender` â†’ `gender`
   - `age` â†’ `age`
   - `country` â†’ `country`
   - `relation` â†’ `relation`

4. **Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:**
   - `isHidden` â†’ `is_hidden`

5. **Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª:**
   - `points` â†’ `points`
   - `level` â†’ `level`
   - `totalPoints` â†’ `total_points`
   - `levelProgress` â†’ `level_progress`

### Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­

```typescript
async updateUser(id: number, updates: Partial<User>): Promise<User | undefined> {
  try {
    const directDb = getDirectSqliteConnection();

    // Build dynamic update query
    const setClause = [];
    const values = [];

    if (updates.isOnline !== undefined) {
      setClause.push('is_online = ?');
      values.push(updates.isOnline ? 1 : 0);
    }

    if (updates.lastSeen !== undefined) {
      setClause.push('last_seen = ?');
      values.push(updates.lastSeen ? updates.lastSeen.toISOString() : null);
    }

    if (updates.profileImage !== undefined) {
      setClause.push('profile_image = ?');
      values.push(updates.profileImage);
    }

    if (updates.profileBanner !== undefined) {
      setClause.push('profile_banner = ?');
      values.push(updates.profileBanner);
    }

    if (updates.profileBackgroundColor !== undefined) {
      setClause.push('profile_background_color = ?');
      values.push(updates.profileBackgroundColor);
    }

    // ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø¶Ø§ÙØ©

    if (setClause.length === 0) {
      return this.getUser(id);
    }

    values.push(id);
    const stmt = directDb.prepare(`UPDATE users SET ${setClause.join(', ')} WHERE id = ?`);
    stmt.run(...values);

    return this.getUser(id);
  } catch (error) {
    console.error('Error updating user:', error);
    return undefined;
  }
}
```

## ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªØ­Ù‚Ù‚

### Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„

```javascript
const result1 = updateUser(1, { profileImage: '/uploads/profiles/test-avatar.jpg' });
// Ø§Ù„Ù†ØªÙŠØ¬Ø©: âœ… Ù†Ø¬Ø­
// SQL: UPDATE users SET profile_image = ? WHERE id = ?
```

### Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø§Ù†Ø±

```javascript
const result2 = updateUser(1, { profileBanner: '/uploads/banners/test-banner.jpg' });
// Ø§Ù„Ù†ØªÙŠØ¬Ø©: âœ… Ù†Ø¬Ø­
// SQL: UPDATE users SET profile_banner = ? WHERE id = ?
```

### Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ø¯ÙŠØ« Ù…ØªØ¹Ø¯Ø¯

```javascript
const result4 = updateUser(1, {
  profileImage: '/uploads/profiles/test-avatar.jpg',
  profileBanner: '/uploads/banners/test-banner.jpg',
  profileBackgroundColor: '#ff0000',
});
// Ø§Ù„Ù†ØªÙŠØ¬Ø©: âœ… Ù†Ø¬Ø­
// SQL: UPDATE users SET profile_image = ?, profile_banner = ?, profile_background_color = ? WHERE id = ?
```

## ğŸ“Š Ø§Ù„Ù†ØªØ§Ø¦Ø¬

### âœ… Ù…Ø§ ØªÙ… Ø¥ØµÙ„Ø§Ø­Ù‡

1. **ØµÙˆØ± Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„:** Ø§Ù„Ø¢Ù† ÙŠØªÙ… Ø­ÙØ¸Ù‡Ø§ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
2. **ØµÙˆØ± Ø§Ù„Ø¨Ø§Ù†Ø±:** Ø§Ù„Ø¢Ù† ÙŠØªÙ… Ø­ÙØ¸Ù‡Ø§ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
3. **Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¸Ù‡Ø±:** Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
4. **Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:** ÙŠÙ…ÙƒÙ† ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©
5. **Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª:** Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø· ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„

### ğŸ”— Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©

- `/api/upload/profile-image` - Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„
- `/api/upload/profile-banner` - Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø§Ù†Ø±
- Ø¬Ù…ÙŠØ¹ ÙˆØ§Ø¬Ù‡Ø§Øª ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…

### ğŸ“ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©

- `server/storage-fixed.ts` - Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø«Ø©

## ğŸ¯ Ø§Ù„Ø®Ù„Ø§ØµØ©

**Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:** ØµÙˆØ± Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ÙˆØ§Ù„Ø¨Ø§Ù†Ø± Ù„Ù… ØªÙƒÙ† Ù…Ø±Ø¨ÙˆØ·Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø³Ø¨Ø¨ Ù†Ù‚Øµ ÙÙŠ Ø¯Ø§Ù„Ø© `updateUser`.

**Ø§Ù„Ø­Ù„:** ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¯Ø¹Ù… ÙƒØ§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙÙŠ Ø¯Ø§Ù„Ø© `updateUser`.

**Ø§Ù„Ù†ØªÙŠØ¬Ø©:** âœ… ØµÙˆØ± Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ÙˆØ§Ù„Ø¨Ø§Ù†Ø± Ù…Ø±Ø¨ÙˆØ·Ø© Ø§Ù„Ø¢Ù† ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.

---

**ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµÙ„Ø§Ø­:** 27 ÙŠÙˆÙ„ÙŠÙˆ 2025  
**Ø§Ù„Ø­Ø§Ù„Ø©:** âœ… Ù…ÙƒØªÙ…Ù„ ÙˆÙ…Ø®ØªØ¨Ø±  
**Ø§Ù„Ù…Ø·ÙˆØ±:** Claude Sonnet 4
